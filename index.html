<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ—æµ·é“å…­æ—¥éŠ</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- è¨­å®šå­—é«”èˆ‡æ¨£å¼ -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;500;700;900&display=swap');
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f8fafc;
        }
        .header-bg {
            /* å†°é›ªæ¼¸å±¤è‰² */
            background-image: linear-gradient(135deg, #2E4057 0%, #748DA6 100%);
        }
        /* ğŸ’¡ ä¸»å¼·èª¿è‰²èª¿æ•´ç‚ºæ·±é’è—è‰²ï¼Œå‘¼æ‡‰å†°é›ªä¸»é¡Œ */
        .accent-color {
            color: #00A8A0;
        }

        .day-tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            transition: all 0.2s;
            flex-shrink: 0;
        }
        .day-tab:hover {
            background-color: #f0f4f8;
        }
        .day-tab.active {
            /* Tab æ´»èºåº•éƒ¨ç·šæ¢é¡è‰²èˆ‡ä¸»å¼·èª¿è‰²åŒæ­¥ */
            border-bottom-color: #00A8A0;
            color: #00A8A0;
            font-weight: 700;
            background-color: #fff;
        }
        .day-content {
            animation: fadeIn 0.4s ease-in-out;
            min-height: 500px;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(10px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .meal-summary {
            background-color: #F8F9FA;
            border-left: 3px solid #748DA6;
        }
        /* éš±è—è¼¸å…¥æ¡†çš„ä¸Šä¸‹ç®­é ­ (é©ç”¨æ–¼ Chrome, Safari, Edge, Opera) */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        /* éš±è—è¼¸å…¥æ¡†çš„ä¸Šä¸‹ç®­é ­ (é©ç”¨æ–¼ Firefox) */
        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body class="p-0">

    <div id="app" class="max-w-6xl mx-auto bg-white shadow-2xl">

        <!-- é ‚éƒ¨æ¨™é¡Œèˆ‡è¦–è¦ºå€å¡Š -->
        <header class="header-bg p-8 sm:p-12 text-white text-center rounded-b-xl">
            <p class="xl font-light mb-2 tracking-widest">2026 å†¬å­£é™å®š | å…­å¤©äº”å¤œä¹‹æ—…</p>
            <h1 class="text-5xl sm:text-6xl font-black mb-4 tracking-wider">
                âœˆï¸ åŒ—æµ·é“å†¬æ—¥ç¶“å…¸å…­æ—¥éŠ
            </h1>
            <h2 class="text-2xl font-medium opacity-90">
                ç ´å†°èˆ¹ï¼é›ªä¸Šæ´»å‹•ï¼å°æ¨½æ•£ç­–
            </h1>
        </header>

        <!-- äº®é»ã€èˆªç­èˆ‡åŒ¯ç‡æ‘˜è¦å€å¡Š -->
        <div class="p-6 sm:p-10 bg-white border-b border-gray-200">
            <!-- ä½¿ç”¨å…©æ¬„ä½ˆå±€ï¼šå·¦é‚Šæ”¾äº®é»ï¼Œå³é‚Šå‚ç›´å †ç–Šèˆªç­å’ŒåŒ¯ç‡ -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-4">

                <!-- COL 1: ç¨å®¶è¡Œç¨‹äº®é» -->
                <div>
                    <h3 class="text-2xl font-bold accent-color mb-3 border-b pb-2">ğŸ¯ ç¨å®¶è¡Œç¨‹äº®é»</h3>
                    <ul class="space-y-2 text-gray-700 font-medium">
                        <li class="flex items-start">
                            <span class="mr-2 text-xl accent-color flex-shrink-0">ğŸ§</span>
                            <span class="flex-grow min-w-0">Day 2 æ‹œè¨ª<span class="font-bold text-[#00A8A0] bg-[#E0FFFF] px-1 rounded-sm">æ—­å±±å‹•ç‰©åœ’</span>ï¼Œè¿‘è·é›¢è§€è³ä¼éµé›ªåœ°æ•£æ­¥ã€‚</span>
                        </li>
                        <li class="flex items-start">
                            <span class="mr-2 text-xl accent-color flex-shrink-0">ğŸ§Š</span>
                            <span class="flex-grow min-w-0">Day 3 æŒ‘æˆ°é„‚éœæ¬¡å…‹æµ· <span class="font-bold text-[#00A8A0] bg-[#E0FFFF] px-1 rounded-sm">ç´‹åˆ¥ç ´å†°èˆ¹</span> éœ‡æ’¼é«”é©—ã€‚</span>
                        </li>
                        <li class="flex items-start">
                            <span class="mr-2 text-xl accent-color flex-shrink-0">ğŸ›µ</span>
                            <span class="flex-grow min-w-0">åŒ…å«é›ªä¸Šæ‘©æ‰˜è»Šã€é›ªç›†ç­‰<span class="font-bold text-[#00A8A0] bg-[#E0FFFF] px-1 rounded-sm">åˆºæ¿€é›ªä¸Šæ´»å‹•</span>ã€‚</span>
                        </li>
                        <li class="flex items-start">
                            <span class="mr-2 text-xl accent-color flex-shrink-0">â™¨ï¸</span>
                            <span class="flex-grow min-w-0">ä½å®¿ä¸€æ™š<span class="font-bold text-[#00A8A0] bg-[#E0FFFF] px-1 rounded-sm">å±¤é›²å³½æº«æ³‰é£¯åº—</span>ï¼Œäº«å—åŒ—åœ‹æº«æ³‰ä¹‹å¤œã€‚</span>
                        </li>
                    </ul>
                </div>

                <!-- COL 2: èˆªç­/é›†åˆè³‡è¨Š + å³æ™‚åŒ¯ç‡æŸ¥è©¢ (ç°¡ç´„äº’å‹•å¼) -->
                <div>
                    <!-- èˆªç­è³‡è¨Š -->
                    <h3 class="text-2xl font-bold accent-color mb-3 border-b pb-2">âœˆï¸ èˆªç­/é›†åˆè³‡è¨Š</h3>
                    <p class="text-gray-700">å»ç¨‹ï¼š<span class="font-bold text-[#00A8A0] bg-[#E0FFFF] px-1 rounded-sm">è™èˆª IT 234</span> (06:20 - 10:55) ç¬¬ä¸€èˆªå»ˆ ï½œ æ‰˜é‹ 20kg</p>
                    <p class="text-gray-700">å›ç¨‹ï¼š<span class="font-bold text-[#00A8A0] bg-[#E0FFFF] px-1 rounded-sm">è¯èˆª CI 131</span> (14:40 - 18:15) èˆªå»ˆå¾…å®š ï½œ æ‰˜é‹ 2x23kg</p>
                    <p class="text-red-600 font-semibold mt-4">âš ï¸ åœ˜é«”å·´å£«é›†åˆ (Day 2 & Day 3)ï¼š</p>
                    <p class="text-gray-700 pl-4">JR æœ­å¹Œè»Šç«™åŒ—å£ 07:40 æº–æ™‚é›†åˆã€‚</p>

                    <!-- ğŸ’µ NEW: å³æ™‚åŒ¯ç‡å€å¡Š (ç°¡ç´„äº’å‹•å¼æ›ç®—) -->
                    <div id="exchange-rate-block" class="mt-4 pt-4 border-t border-gray-200">
                        <h3 class="text-xl font-bold accent-color mb-2 flex justify-between items-center">
                            <span>ğŸ’µ åŒ¯ç‡è½‰æ›å™¨ (TWD/JPY)</span>
                            <button onclick="fetchExchangeRate()" class="text-xs font-medium text-sky-600 hover:text-sky-700 flex items-center transition duration-150">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M4.39 4.39a8 8 0 0110.82 0l-3.243 3.242a1 1 0 00.707 1.707h.001c.26 0 .515-.102.707-.293l3.242-3.242a8 8 0 00-10.82-10.82zM12 10a2 2 0 11-4 0 2 2 0 014 0zM7.05 13.05a.5.5 0 010-.707l1.95-1.95a1 1 0 00-1.414-1.414l-1.95 1.95a.5.5 0 01-.707 0l-1.95-1.95a.5.5 0 010-.707l1.95-1.95a1 1 0 10-1.414-1.414L2.05 8.949a8 8 0 0011.314 0l1.95-1.95a.5.5 0 01.707 0l1.95 1.95a.5.5 0 010 .707l-1.95 1.95a8 8 0 01-11.314 0z" clip-rule="evenodd" />
                                </svg>
                                é‡æ–°æ•´ç†
                            </button>
                        </h3>

                        <!-- ç°¡ç´„åŒ¯ç‡ç‹€æ…‹æ¢ -->
                        <div id="current-rate-status" class="mb-3 p-2 text-center text-sm font-semibold rounded-lg bg-gray-100 text-gray-600">
                            é»æ“Šã€Œé‡æ–°æ•´ç†ã€ä»¥ç²å–æœ€æ–°åŒ¯ç‡
                        </div>

                        <!-- æ›ç®—è¼¸å…¥/è¼¸å‡ºæ¬„ä½ -->
                        <div class="space-y-3">
                            <!-- TWD è¼¸å…¥ -->
                            <div class="flex items-center space-x-2">
                                <label for="twd-input" class="text-sm font-medium text-gray-700 w-1/4 flex-shrink-0">ğŸ‡¹ğŸ‡¼ TWD</label>
                                <input
                                    type="number"
                                    id="twd-input"
                                    oninput="convertCurrency()"
                                    placeholder="è¼¸å…¥å°å¹£é‡‘é¡"
                                    class="w-full p-2 border border-gray-300 rounded-lg text-base shadow-sm focus:ring-sky-500 focus:border-sky-500"
                                    min="0"
                                >
                            </div>

                            <!-- JPY è¼¸å‡º -->
                            <div class="flex items-center space-x-2">
                                <label class="text-sm font-medium text-gray-700 w-1/4 flex-shrink-0">ğŸ‡¯ğŸ‡µ JPY</label>
                                <div
                                    id="jpy-output"
                                    class="flex-grow p-2 border border-emerald-300 rounded-lg bg-emerald-100 text-base font-bold text-emerald-800 text-right shadow-inner"
                                >
                                    0 JPY
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ©«å‘åˆ‡æ›é¸å–® (Tabs) - ä¿æŒ sticky top-0 -->
        <div class="sticky top-0 z-10 bg-white px-6 sm:px-10 border-b border-gray-300">
            <div id="day-tabs" class="flex overflow-x-auto whitespace-nowrap">
                <!-- Tabs will be rendered here by JS -->
            </div>
        </div>

        <!-- æ¯æ—¥è¡Œç¨‹ç´°ç¯€å…§å®¹å€ -->
        <div id="itinerary-content" class="p-6 sm:p-10 bg-gray-50">
            <!-- Content will be rendered here by JS -->
        </div>

        <!-- åº•éƒ¨å‚™è¨» -->
        <footer class="header-bg p-4 text-center text-white text-sm mt-8">
            <p>â€» æœ¬è¡Œç¨‹ç‚ºå»ºè­°è‰ç¨¿ï¼Œè«‹ç•™æ„åœ–ç‰‡çš†ç‚ºç¤ºæ„åœ–ï¼Œå¯¦éš›é¤é£Ÿ/ä½å®¿ä»¥æœ€çµ‚è¡Œç¨‹ç‚ºæº–ã€‚</p>
        </footer>
    </div>

    <script>
        // --- å…¨åŸŸè®Šæ•¸ ---
        let currentExchangeRate = null;

        // --- è¡Œç¨‹è³‡æ–™ (ä¿æŒä¸è®Š) ---
        const itineraryData = [
            {
                id: 1,
                title: "02/20ï¼šæœ­å¹Œå•Ÿç¨‹ âœˆï¸",
                subtitle: "ã€åˆè­˜æœ­å¹Œã€‘å¾æ©Ÿå ´ç›´å¥”å¸‚å€ï¼Œå±•é–‹æ‚ é–’çš„å†¬å­£æ¼«æ­¥ã€‚",
                details: [
                    { time: "04:00", description: "æ¡ƒåœ’æ©Ÿå ´Terminal 1å ±åˆ°", query: "æ¡ƒåœ’æ©Ÿå ´" },
                    { time: "11:30", description: "æ–°åƒæ­²æ©Ÿå ´å…¥å¢ƒå¾Œï¼Œæ­ä¹˜äº¤é€šå·¥å…·å‰å¾€æœ­å¹Œå¸‚å€ã€‚", query: "æ–°åƒåƒæ­²æ©Ÿå ´" },
                    { time: "15:00", description: "åƒè§€**å¤§é€šå…¬åœ’**åŠç¶“å…¸åœ°æ¨™**æœ­å¹Œé›»è¦–å¡”**ã€‚", query: "æœ­å¹Œå¤§é€šå…¬åœ’ æœ­å¹Œé›»è¦–å¡”" },
                    { time: "18:30", description: "åœ¨ç¾é£Ÿèˆ‡è³¼ç‰©å¤©å ‚**ç‹¸å°è·¯å•†åº—è¡—**è‡ªç”±æ´»å‹•ï¼Œäº«å—æ—¥å¼æ™šé¤ã€‚", query: "æœ­å¹Œç‹¸å°è·¯å•†åº—è¡—" }
                ],
                meals: "æ©Ÿå ´è‡ªç† / ç‹¸å°è·¯è‡ªç†",
                lodging: "æœ­å¹Œå¸‚å€é£¯åº—",
            },
            {
                id: 2,
                title: "02/21ï¼šä¼éµï¼é›ªä¸Šæ´»å‹•ï¼æº«æ³‰ ğŸ§",
                subtitle: "ã€å†°é›ªæ¨‚åœ’ã€‘æ•´æ—¥ç²¾å½©æ´»å‹•ï¼Œä»¥æº«æ³‰è§£é™¤ç–²å‹ã€‚",
                warning: "âš ï¸ åœ˜é«”å·´å£«è¡Œç¨‹ï¼š07:40 JRæœ­å¹ŒåŒ—å£é›†åˆ",
                details: [
                    { time: "08:00", description: "æ­ä¹˜å°ˆå±¬å·´å£«å‰å¾€**æ—­å±±å‹•ç‰©åœ’**ï¼Œè§€è³å†¬å­£é™å®šçš„ä¼éµæ•£æ­¥ã€‚", query: "æ—­å±±å‹•ç‰©åœ’" },
                    { time: "12:00", description: "åˆé¤æ™‚é–“ (ç„—çƒ¤èƒèŸ¹æµ·é®®é™¶æ¿ç‡’å¾¡è†³)ã€‚", query: "æ—­å·åˆé¤åœ°é»" },
                    { time: "14:00", description: "å‰å¾€é›ªä¸Šæ¨‚åœ’ï¼Œé«”é©—é›ªä¸Šæ‘©æ‰˜è»Šã€é›ªç›†ã€æ©¡çš®è‰‡ç­‰**åˆºæ¿€é›ªä¸Šæ´»å‹•**ã€‚", query: "åŒ—æµ·é“é›ªä¸Šæ¨‚åœ’" },
                    { time: "18:00", description: "å°ˆè»Šå‰å¾€**å±¤é›²å³½æº«æ³‰å€**ï¼Œäº«å—é£¯åº—å…§è±ªè¯æ™šé¤åŠæº«æ³‰ã€‚", query: "å±¤é›²å³½æº«æ³‰é£¯åº—" }
                ],
                meals: "ç„—çƒ¤èƒèŸ¹æµ·é®®é™¶æ¿ç‡’å¾¡è†³ / æº«æ³‰é£¯åº—è±ªè¯æ™šé¤",
                lodging: "**å±¤é›²å³½å‘¨é‚Šæº«æ³‰é£¯åº—**",
            },
            {
                id: 3,
                title: "02/22ï¼šç´‹åˆ¥ç ´å†°èˆ¹ï¼é…’é€ å·¡ç¦® ğŸš¢",
                subtitle: "ã€æµ·ä¹‹éœ‡æ’¼ã€‘æ¬£è³é„‚éœæ¬¡å…‹æµ·çš„æµå†°å¥‡æ™¯ã€‚",
                warning: "âš ï¸ åœ˜é«”å·´å£«è¡Œç¨‹ï¼šç´„ 18:00-19:00 è¿”æŠµ JR æœ­å¹Œè»Šç«™è§£æ•£",
                details: [
                    { time: "08:30", description: "åƒè§€**éŠ€æ²³æµæ˜Ÿç€‘å¸ƒ** (å†¬å­£æ™¯è§€)ã€‚", query: "éŠ€æ²³æµæ˜Ÿç€‘å¸ƒ" },
                    { time: "10:30", description: "é‡é ­æˆ²ï¼šæŠµé”ç´‹åˆ¥ï¼Œæ­ä¹˜**ç ´å†°èˆ¹** (GARINKO è™Ÿ) é«”é©—ç ´å†°ã€‚", query: "ç´‹åˆ¥ GARINKO è™Ÿ ç ´å†°èˆ¹" },
                    { time: "12:30", description: "è±ªè¯èŸ¹è…³å¹²è²ç«¯çˆç‡’å¥—é¤åˆé¤ã€‚", query: "ç´‹åˆ¥æµ·é®®é¤å»³" },
                    { time: "14:30", description: "æ–‡åŒ–é«”é©—ï¼šåƒè§€**æ—­å·ç”·å±±é…’é€ **ï¼Œäº†è§£æ¸…é…’é‡€è£½éç¨‹ã€‚", query: "æ—­å·ç”·å±±é…’é€ " },
                    { time: "18:00", description: "è¿”å›æœ­å¹Œå¸‚å€é£¯åº—è¾¦ç†å…¥ä½ï¼Œæ™šé¤è‡ªç†ã€‚", query: "æœ­å¹Œå¸‚å€é£¯åº—" }
                ],
                meals: "è±ªè¯èŸ¹è…³å¹²è²ç«¯çˆç‡’å¥—é¤ / æœ­å¹Œå¸‚å€è‡ªç†",
                lodging: "æœ­å¹Œå¸‚å€é£¯åº—",
            },
            {
                id: 4,
                title: "02/23ï¼šå°æ¨½é‹æ²³ï¼éŸ³æ¨‚ç›’å ‚ ğŸ””",
                subtitle: "ã€è‡ªç”±æ•£ç­–ã€‘æ­ä¹˜ JR å‰å¾€ï¼Œç›¡æƒ…äº«å—å°æ¨½çš„æµªæ¼«æ°›åœã€‚",
                details: [
                    { time: "10:00", description: "å¾æœ­å¹Œæ­ä¹˜ JR å‰å¾€å°æ¨½ã€‚", query: "å°æ¨½ JR ç«™" },
                    { time: "11:00", description: "**å°æ¨½é‹æ²³**ï¼šæ²¿è‘—é‹æ²³é‚Šæ•£æ­¥ï¼Œæ‹æ”ç¶“å…¸å€‰åº«ç¾¤ã€‚", query: "å°æ¨½é‹æ²³" },
                    { time: "12:30", description: "åˆé¤ï¼šå°æ¨½å£½å¸æˆ–è‡ªç†ã€‚", query: "å°æ¨½å£½å¸åº—" },
                    { time: "14:00", description: "åƒè§€**åŒ—ä¸€ç¡å­é¤¨**èˆ‡**éŸ³æ¨‚ç›’åšç‰©é¤¨**ï¼Œæ„Ÿå—æ‡·èˆŠæ°£æ¯ã€‚", query: "å°æ¨½éŸ³æ¨‚ç›’åšç‰©é¤¨ åŒ—ä¸€ç¡å­é¤¨" },
                    { time: "16:00", description: "åˆ¥å¿˜äº†åœ¨ **LeTAO ç¸½åº—**äº«å—ä¸‹åˆèŒ¶ã€‚", query: "å°æ¨½ LeTAO ç¸½åº—" },
                    { time: "18:30", description: "æ™šé¤ï¼šè¿”å›æœ­å¹Œå¾Œï¼Œå»ºè­°å‰å¾€æœ­å¹Œæ‹‰éºµå…±å’Œåœ‹ (è‡ªç†)ã€‚", query: "æœ­å¹Œæ‹‰éºµå…±å’Œåœ‹" }
                ],
                meals: "å°æ¨½å£½å¸æˆ–è‡ªç† / æœ­å¹Œæ‹‰éºµå…±å’Œåœ‹ (è‡ªç†)",
                lodging: "æœ­å¹Œå¸‚å€é£¯åº—",
            },
            {
                id: 5,
                title: "02/24ï¼šæµ·é®®è³¼ç‰©ï¼ä¸‰å¤§èŸ¹å®´ ğŸ›ï¸",
                subtitle: "ã€ç¾é£Ÿå¤©å ‚ã€‘ä¸€æ•´å¤©ç»çµ¦åŒ—æµ·é“çš„ç¾å‘³èˆ‡è³¼ç‰©ã€‚",
                details: [
                    { time: "09:30", description: "ä¸Šåˆï¼šåƒæ‹œ**åŒ—æµ·é“ç¥å®®**ã€‚", query: "åŒ—æµ·é“ç¥å®®" },
                    { time: "11:00", description: "å‰å¾€**æœ­å¹Œå ´å¤–å¸‚å ´**ï¼Œäº«ç”¨è¶…æ–°é®®æµ·é®®ä¸¼ (è‡ªç†)ã€‚", query: "æœ­å¹Œå ´å¤–å¸‚å ´" },
                    { time: "14:00", description: "ä¸‹åˆï¼šåœ¨**ç‹¸å°è·¯å•†åº—è¡—**æˆ–**å¤§é€šå…¬åœ’**å‘¨é‚Šé€²è¡Œè£œè²¨è³¼ç‰©ã€‚", query: "ç‹¸å°è·¯å•†åº—è¡— å¤§é€šå…¬åœ’" },
                    { time: "19:00", description: "æ™šé¤ï¼šå»ºè­°äº«å—ç¶“å…¸çš„**ä¸‰å¤§èŸ¹åƒåˆ°é£½** (å¸ç‹èŸ¹ã€æ¾è‘‰èŸ¹ã€æ¯›èŸ¹) (è‡ªç†)ã€‚", query: "æœ­å¹Œä¸‰å¤§èŸ¹åƒåˆ°é£½" }
                ],
                meals: "å ´å¤–å¸‚å ´æµ·é®®ä¸¼ (è‡ªç†) / ä¸‰å¤§èŸ¹åƒåˆ°é£½ (è‡ªç†)",
                lodging: "æœ­å¹Œå¸‚å€é£¯åº—",
            },
            {
                id: 6,
                title: "02/25ï¼šæœ€çµ‚æ¡è²·ï¼è¿”å®¶ ğŸ ",
                subtitle: "ã€å®Œç¾å¥é»ã€‘è¼•é¬†è¡€æ‹šå¾Œï¼Œå¸¶è‘—æ»¿æ»¿å›æ†¶è¸ä¸Šæ­¸é€”ã€‚",
                details: [
                    { time: "10:00", description: "é€€æˆ¿å¾Œï¼Œå‰å¾€**ä¸‰äº•OUTLETè³¼ç‰©ä¸­å¿ƒ**æˆ– Rera Outletã€‚", query: "æœ­å¹Œä¸‰äº•OUTLETè³¼ç‰©ä¸­å¿ƒ" },
                    { time: "12:00", description: "åœ¨ OUTLET å…§äº«ç”¨åˆé¤ã€‚", query: "OUTLET é¤å»³" },
                    { time: "13:30", description: "é›†åˆå‰å¾€æ–°åƒæ­²æ©Ÿå ´ã€‚", query: "æ–°åƒæ­²æ©Ÿå ´" },
                    { time: "14:40", description: "æ­ä¹˜è¯èˆª CI 131 ç­æ©Ÿè¿”å›å°åŒ—ã€‚", query: "æ–°åƒæ­²æ©Ÿå ´" }
                ],
                meals: "OUTLET ç°¡é¤ (è‡ªç†) / æ©Ÿä¸Šç°¡é¤",
                lodging: "æº«æš–çš„å®¶",
            },
        ];

        const tabsContainer = document.getElementById('day-tabs');
        const contentContainer = document.getElementById('itinerary-content');

        /**
         * åŸ·è¡Œè²¨å¹£æ›ç®—é‚è¼¯
         */
        window.convertCurrency = function() {
            const twdInput = document.getElementById('twd-input');
            const jpyOutput = document.getElementById('jpy-output');
            const twdAmount = parseFloat(twdInput.value);

            if (currentExchangeRate === null) {
                jpyOutput.textContent = 'è«‹å…ˆç²å–åŒ¯ç‡';
                jpyOutput.classList.remove('text-emerald-800');
                jpyOutput.classList.add('text-red-500');
                return;
            }

            if (isNaN(twdAmount) || twdAmount <= 0) {
                jpyOutput.textContent = '0 JPY';
                jpyOutput.classList.remove('text-red-500');
                jpyOutput.classList.add('text-emerald-800');
                return;
            }

            // æ›ç®—ä¸¦å››æ¨äº”å…¥åˆ°æ•´æ•¸ï¼Œå› ç‚ºæ—¥åœ“é€šå¸¸ä¸è¨ˆç®—å°æ•¸
            const jpyAmount = Math.round(twdAmount * currentExchangeRate);

            // ä½¿ç”¨ toLocaleString å¢åŠ åƒåˆ†ä½é€—è™Ÿ
            jpyOutput.textContent = `${jpyAmount.toLocaleString('en-US')} JPY`;
            jpyOutput.classList.remove('text-red-500');
            jpyOutput.classList.add('text-emerald-800');
        }

        /**
         * æŸ¥è©¢ä¸¦ç²å–æœ€æ–°åŒ¯ç‡
         */
        async function fetchExchangeRate() {
            const statusDisplay = document.getElementById('current-rate-status');
            const systemPrompt = "ä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„é‡‘èåŠ©ç†ã€‚è«‹ä½ æŸ¥è©¢æœ€æ–°çš„å°å¹£ (TWD) å…Œæ—¥åœ“ (JPY) åŒ¯ç‡ã€‚è«‹æä¾›ä¸€å€‹ç°¡æ½”çš„å¥å­ï¼Œèªªæ˜ 1 TWD å¯ä»¥å…Œæ›å¤šå°‘ JPYï¼Œä¸¦ä¸”æ˜ç¢ºæä¾›åŒ¯ç‡æ•¸å€¼ï¼ˆå››æ¨äº”å…¥åˆ°å°æ•¸é»å¾Œå››ä½ï¼‰ã€‚è«‹ä»¥ç¹é«”ä¸­æ–‡å›ç­”ã€‚";
            const userQuery = "æœ€æ–°çš„å°å¹£ (TWD) å…Œæ—¥åœ“ (JPY) åŒ¯ç‡ã€‚";
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

            // åˆå§‹è¼‰å…¥ç‹€æ…‹
            statusDisplay.innerHTML = `
                <div class="flex items-center justify-center space-x-2 text-sky-600">
                    <svg class="animate-spin h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <p>æ­£åœ¨æŸ¥è©¢å³æ™‚åŒ¯ç‡...</p>
                </div>
            `;
            // èª¿æ•´ç‹€æ…‹æ¢é¡è‰²ç‚ºè—è‰²ï¼ˆæŸ¥è©¢ä¸­ï¼‰
            statusDisplay.classList.remove('bg-gray-100', 'bg-red-50', 'bg-emerald-50', 'text-gray-600', 'text-red-600', 'text-emerald-800');
            statusDisplay.classList.add('bg-sky-50', 'text-sky-700');
            currentExchangeRate = null; // æ¸…é™¤èˆŠåŒ¯ç‡
            convertCurrency(); // è§¸ç™¼æ¸…ç©ºæ›ç®—çµæœ

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            const maxRetries = 5;
            let delay = 1000;

            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        if (response.status === 429 && i < maxRetries - 1) {
                            await new Promise(resolve => setTimeout(resolve, delay));
                            delay *= 2; // Exponential backoff
                            continue;
                        }
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    const candidate = result.candidates?.[0];

                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        const text = candidate.content.parts[0].text;

                        // 1. å˜—è©¦å¾æ–‡å­—ä¸­è§£æåŒ¯ç‡æ•¸å€¼ (æ ¼å¼: X.XXXX)
                        const rateMatch = text.match(/(\d+\.\d{3,5})/);
                        let parsedRate = rateMatch ? parseFloat(rateMatch[1]) : null;

                        if (parsedRate && parsedRate > 0) {
                            currentExchangeRate = parsedRate; // è¨­å®šå…¨åŸŸåŒ¯ç‡
                            convertCurrency(); // åŸ·è¡Œæ›ç®—

                            // 2. æ“·å–è³‡æ–™ä¾†æº
                            let sources = [];
                            const groundingMetadata = candidate.groundingMetadata;
                            if (groundingMetadata && groundingMetadata.groundingAttributions) {
                                sources = groundingMetadata.groundingAttributions
                                    .map(attribution => ({
                                        uri: attribution.web?.uri,
                                        title: attribution.web?.title,
                                    }))
                                    .filter(source => source.uri && source.title);
                            }

                            // 3. é¡¯ç¤ºçµæœ (ç°¡åŒ–)
                            let sourceText = sources.length > 0 ? `(è³‡æ–™: ${sources[0].title})` : '';

                            statusDisplay.innerHTML = `
                                <p class="text-xl font-extrabold">1 TWD = ${currentExchangeRate.toFixed(4)} JPY</p>
                                <p class="text-xs font-normal mt-0.5">${sourceText}</p>
                            `;
                            // èª¿æ•´ç‹€æ…‹æ¢é¡è‰²ç‚ºç¶ è‰²ï¼ˆæˆåŠŸï¼‰
                            statusDisplay.classList.remove('bg-sky-50', 'text-sky-700');
                            statusDisplay.classList.add('bg-emerald-50', 'text-emerald-800');
                            return;
                        } else {
                            // ç„¡æ³•è§£æå‡ºæ•¸å­—
                            statusDisplay.innerHTML = 'ç„¡æ³•è§£æåŒ¯ç‡æ•¸å€¼ï¼Œè«‹å†è©¦ä¸€æ¬¡ã€‚';
                            statusDisplay.classList.remove('bg-sky-50', 'text-sky-700');
                            statusDisplay.classList.add('bg-red-50', 'text-red-600');
                            currentExchangeRate = null;
                            convertCurrency();
                            return;
                        }
                    } else {
                        // API è¿”å›çµæ§‹ä¸å°
                        statusDisplay.innerHTML = 'åŒ¯ç‡æŸ¥è©¢å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚';
                        statusDisplay.classList.remove('bg-sky-50', 'text-sky-700');
                        statusDisplay.classList.add('bg-red-50', 'text-red-600');
                        currentExchangeRate = null;
                        convertCurrency();
                        return;
                    }

                } catch (error) {
                    console.error("API Call Error:", error);
                    if (i === maxRetries - 1) {
                        statusDisplay.innerHTML = 'ç¶²çµ¡éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥é€£ç·šæˆ–ç¨å¾Œå†è©¦ã€‚';
                        statusDisplay.classList.remove('bg-sky-50', 'text-sky-700');
                        statusDisplay.classList.add('bg-red-50', 'text-red-600');
                        currentExchangeRate = null;
                        convertCurrency();
                    } else {
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2;
                    }
                }
            }
        }
        // --- åŒ¯ç‡æŸ¥è©¢/æ›ç®—é‚è¼¯çµæŸ ---


        // ğŸ’¡ æ–°å¢åŠŸèƒ½ï¼šé»æ“ŠæŒ‰éˆ•é–‹å•Ÿ Google Maps æœå°‹ (ä¿æŒä¸è®Š)
        window.openInGoogleMaps = function(query) {
            if (query) {
                const url = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(query)}`;
                window.open(url, '_blank');
            } else {
                console.warn("ç„¡æ³•é–‹å•Ÿåœ°åœ–ï¼šç¼ºå°‘æŸ¥è©¢å­—ä¸²ã€‚");
            }
        }

        // 1. æ¸²æŸ“ Tabs (ä¿æŒä¸è®Š)
        function renderTabs() {
            tabsContainer.innerHTML = '';
            itineraryData.forEach(day => {
                const button = document.createElement('button');
                button.className = 'day-tab text-gray-700';
                button.textContent = `Day ${day.id}`;
                button.setAttribute('data-day', day.id);
                button.onclick = () => switchDay(day.id);
                tabsContainer.appendChild(button);
            });
        }

        // 2. æ¸²æŸ“å–®æ—¥å…§å®¹ (ä¿æŒä¸è®Š)
        function renderDayContent(day) {

            const highlightText = (text) => {
                return text.replace(/\*\*(.*?)\*\*/g, (match, p1) => {
                    return `<span class="font-bold text-[#00A8A0] bg-[#E0FFFF] px-1 rounded-sm">${p1}</span>`;
                });
            };

            const timeToMinutes = (timeStr) => {
                const [hours, minutes] = timeStr.split(':').map(Number);
                return hours * 60 + minutes;
            };

            const detailsHtml = `
                <h4 class="text-xl font-bold text-[#2E4057] mb-4 border-l-4 border-[#748DA6] pl-2">è¡Œç¨‹ç´°ç¯€ï¼š</h4>
                <div class="space-y-4">
                    ${day.details.map((item, index) => {
                        let durationHtml = '';
                        if (index < day.details.length - 1) {
                            const currentTime = timeToMinutes(item.time);
                            const nextTime = timeToMinutes(day.details[index + 1].time);
                            let diffMinutes = nextTime - currentTime;

                            if (diffMinutes < 0) {
                                diffMinutes += 24 * 60;
                            }

                            const diffHours = Math.floor(diffMinutes / 60);
                            const remainingMinutes = diffMinutes % 60;

                            let durationText = '';
                            if (diffHours > 0) durationText += `${diffHours}å°æ™‚`;
                            if (remainingMinutes > 0 || diffHours === 0) durationText += `${remainingMinutes}åˆ†é˜`;

                            // æ™‚é–“æµæŒ‡ç¤ºå™¨ (ä¿æŒç„¡æ¡†ç·šæ¨£å¼)
                            durationHtml = `
                                <div class="flex flex-col items-start ml-5 sm:ml-6 mt-1 mb-1">
                                    <div class="w-0.5 h-6 bg-gray-300 ml-3"></div>
                                    <div class="relative text-gray-600 px-3 py-1 text-xs font-medium flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l3 3a1 1 0 001.414-1.414L11 9.586V6z" clip-rule="evenodd" />
                                        </svg>
                                        é è¨ˆèŠ±è²»ï¼š${durationText}
                                    </div>
                                    <div class="w-0.5 h-6 bg-gray-300 ml-3"></div>
                                </div>
                            `;
                        }

                        // æ´»å‹•å€å¡Š HTML
                        const activityBlock = `
                            <div class="bg-white p-4 rounded-xl shadow border border-gray-200 transition duration-300 hover:shadow-lg flex justify-between items-start">
                                <!-- æ™‚é–“èˆ‡æ´»å‹•æè¿° -->
                                <div class="flex-grow">
                                    <p class="text-sm font-bold text-gray-500 mb-1 flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 text-[#748DA6]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                        ${item.time}
                                    </p>
                                    <p class="text-gray-800 text-base font-medium leading-normal">
                                        ${highlightText(item.description)}
                                    </p>
                                </div>

                                <!-- åœ°åœ–é–‹å•ŸæŒ‰éˆ• (åœ°åœ–åœ–ç¤º) -->
                                ${item.query ? `
                                    <button
                                        class="p-2 ml-4 bg-sky-500 text-white rounded-full hover:bg-sky-600 transition duration-150 shadow-md flex-shrink-0"
                                        title="åœ¨åœ°åœ–ä¸Šé–‹å•Ÿ ${item.description.replace(/<[^>]*>/g, '').replace(/\*\*/g, '')}"
                                        onclick="openInGoogleMaps('${item.query.replace(/'/g, "\\'")}')"
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
                                        </svg>
                                    </button>
                                ` : ''}
                            </div>
                        `;

                        return activityBlock + durationHtml;
                    }).join('')}
                </div>
            `;

            return `
                <div class="day-content p-6 sm:p-8 bg-white rounded-xl shadow-lg border border-gray-100">
                    <h3 class="text-4xl font-black accent-color mb-3 border-b-2 pb-1">${day.title}</h3>

                    <p class="text-red-600 font-semibold mb-4 text-lg">
                        ${day.warning ? `âš ï¸ ${day.warning}` : ''}
                    </p>

                    <p class="text-gray-700 mb-6 font-medium text-xl leading-relaxed">${day.subtitle}</p>

                    ${detailsHtml} <!-- æ’å…¥è¡Œç¨‹ç´°ç¯€ -->

                    <div class="meal-summary p-4 mt-8 rounded-lg text-base font-semibold grid grid-cols-1 sm:grid-cols-2 gap-2">
                        <div><span class="text-[#2E4057]">ğŸ½ï¸ åˆ/æ™šé¤ï¼š</span> ${day.meals}</div>
                        <div><span class="text-[#2E4057]">ğŸ¨ ä½å®¿ï¼š</span> ${day.lodging}</div>
                    </div>
                </div>
            `;
        }

        // 3. åˆ‡æ›é¡¯ç¤ºæ—¥æœŸçš„é‚è¼¯ (ä¿æŒä¸è®Š)
        function switchDay(dayId) {
            const dayData = itineraryData.find(d => d.id === dayId);
            if (!dayData) return;

            contentContainer.innerHTML = renderDayContent(dayData);

            document.querySelectorAll('.day-tab').forEach(tab => {
                tab.classList.remove('active');
                if (parseInt(tab.getAttribute('data-day')) === dayId) {
                    tab.classList.add('active');
                }
            });
        }

        // 4. åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼
        window.onload = function() {
            renderTabs();
            switchDay(1);
            // é é¢è¼‰å…¥æ™‚è‡ªå‹•è¼‰å…¥åŒ¯ç‡
            fetchExchangeRate();
        };
    </script>

</body>
</html>