<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ—æµ·é“å…­æ—¥éŠ</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- è¨­å®šå­—é«”èˆ‡æ¨£å¼ -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;500;700;900&family=Noto+Sans+JP:wght@400;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f8fafc; }
        .header-bg { background-image: linear-gradient(135deg, #2E4057 0%, #748DA6 100%); }
        .accent-color { color: #00A8A0; }
        
        /* å°è¦½åˆ— Tab æ¨£å¼ */
        .tab-item {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            transition: all 0.2s;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            white-space: nowrap;
            border-radius: 0;
        }
        
        /* ä¸»é¸å–® */
        .main-tab:hover { color: #00A8A0; border-bottom-color: #00A8A0; }
        .main-tab.active {
            border-bottom-color: #00A8A0;
            color: #00A8A0;
            font-weight: 700;
            background-color: #fff;
        }
        
        /* Day Tabs (ç¶­æŒæ–‡å­—+åº•ç·š) */
        .day-tab {
            color: #64748b; 
            background-color: transparent;
        }
        .day-tab:hover {
            color: #3C79D5;
            background-color: #f8fafc;
        }
        .day-tab.active {
            border-bottom-color: #3C79D5;
            color: #3C79D5;
            font-weight: 700;
            background-color: #f0f4f8;
        }

        .content-area { animation: fadeIn 0.4s ease-in-out; min-height: 500px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .meal-summary { background-color: #F8F9FA; border-left: 3px solid #748DA6; }
        
        /* Modal */
        #location-modal { transition: opacity 0.2s ease-in-out; }
        #location-modal.hidden { opacity: 0; pointer-events: none; }
        #location-modal:not(.hidden) { opacity: 1; pointer-events: auto; }
        
        /* Highlight Styles */
        .highlight-text-clickable { font-weight: 700; color: #0369a1; background-color: #e0f2fe; padding: 0 4px; border-radius: 2px; cursor: pointer; text-decoration: underline; text-decoration-color: #7dd3fc; text-decoration-thickness: 2px; }
        .highlight-text-activity { font-weight: 700; color: #be185d; background-color: #fce7f3; padding: 0 4px; border-radius: 2px; }
        .highlight-text-location { font-weight: 700; color: #334155; background-color: #e2e8f0; padding: 0 4px; border-radius: 2px; }
        .location-text-static { font-weight: 700; color: #334155; background-color: #e2e8f0; padding: 0 4px; border-radius: 2px; }

        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
        
        /* Checklist Styles */
        .checklist-item { cursor: pointer; transition: all 0.2s; }
        .checklist-item:hover { background-color: #f0f9ff; }
        .checklist-checkbox { accent-color: #00A8A0; width: 1.25rem; height: 1.25rem; }
        .checked-text { text-decoration: line-through; color: #9ca3af; }
        
        .api-key-reminder { display: none; }
    </style>
</head>
<body class="min-h-screen">

    <div id="app" class="max-w-6xl mx-auto bg-white shadow-2xl relative">
        
        <!-- Modal åœ°é»å°å¡ -->
        <div id="location-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden p-4">
            <div class="bg-white rounded-xl shadow-2xl max-w-sm w-full p-6 relative transform transition-all scale-100">
                <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
                <div class="mb-4 border-b pb-3 pr-8">
                    <h3 id="modal-title" class="text-2xl font-bold text-gray-800 leading-tight">åœ°é»åç¨±</h3>
                    <p id="modal-jp-name" class="text-sm text-sky-600 font-medium font-['Noto_Sans_JP'] mt-1">Japanese Name</p>
                </div>
                <div class="space-y-4">
                    <div class="flex items-start"><span class="text-xl mr-3 mt-0.5">ğŸ“</span><div><p class="text-xs font-bold text-gray-400 uppercase tracking-wide">åœ°å€</p><p id="modal-address" class="text-gray-700 text-sm leading-relaxed font-medium">åœ°å€è¼‰å…¥ä¸­...</p></div></div>
                    <div class="flex items-start"><span class="text-xl mr-3 mt-0.5">ğŸ•’</span><div><p class="text-xs font-bold text-gray-400 uppercase tracking-wide">ç‡Ÿæ¥­æ™‚é–“</p><p id="modal-hours" class="text-gray-700 text-sm leading-relaxed font-medium">ç‡Ÿæ¥­æ™‚é–“è¼‰å…¥ä¸­...</p></div></div>
                    <!-- é–€ç¥¨è³‡è¨Š -->
                    <div id="modal-ticket-row" class="flex items-start hidden"><span class="text-xl mr-3 mt-0.5">ğŸŸï¸</span><div><p class="text-xs font-bold text-gray-400 uppercase tracking-wide">é–€ç¥¨è²»ç”¨</p><p id="modal-ticket" class="text-orange-600 text-sm leading-relaxed font-bold">ç„¡è³‡è¨Š</p></div></div>
                    <!-- æ©Ÿå‹è³‡è¨Š (æ–°å¢) -->
                    <div id="modal-aircraft-row" class="flex items-start hidden"><span class="text-xl mr-3 mt-0.5">âœˆï¸</span><div><p class="text-xs font-bold text-gray-400 uppercase tracking-wide">æ©Ÿå‹</p><p id="modal-aircraft" class="text-slate-600 text-sm leading-relaxed font-bold">è¼‰å…¥ä¸­...</p></div></div>
                </div>
                <div class="mt-6 pt-4 border-t border-gray-100">
                    <button id="modal-map-btn" class="w-full bg-[#00A8A0] text-white py-2.5 rounded-lg font-bold hover:bg-[#008F87] transition flex items-center justify-center shadow-md">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" /></svg>
                        é–‹å•Ÿ Google Maps
                    </button>
                </div>
            </div>
        </div>

        <!-- Header -->
        <header class="header-bg p-6 sm:p-10 text-white text-center rounded-b-xl relative">
            <h1 class="text-3xl sm:text-4xl font-extrabold opacity-95 mb-2">âœˆï¸ 2026 å†¬å­£é™å®š | åŒ—æµ·é“å…­å¤©äº”å¤œä¹‹æ—…</h1>
            <p class="text-lg font-light tracking-widest">ç ´å†°èˆ¹ï¼é›ªä¸Šæ´»å‹•ï¼å°æ¨½æ•£ç­–</p>
        </header>

        <!-- å°è¦½åˆ— (Sticky) -->
        <div class="sticky top-0 z-10 bg-white shadow-md">
            <div id="main-tabs" class="flex overflow-x-auto whitespace-nowrap px-4 sm:px-6 border-b border-gray-300"></div>
            <!-- Day Tabs å®¹å™¨ï¼šç°è‰²èƒŒæ™¯ + ä¸‹é‚Šæ¡† -->
            <div id="day-tabs" class="flex overflow-x-auto whitespace-nowrap px-4 sm:px-6 border-b border-gray-200 bg-gray-50" style="display: none;"></div>
        </div>

        <div id="dynamic-content" class="content-area bg-gray-50 px-4 sm:px-6">
            <div class="text-center text-gray-500 py-16">è¼‰å…¥ä¸­...</div>
        </div>

        <footer class="header-bg p-4 text-center text-white text-sm mt-8">
            <p>â€» æœ¬è¡Œç¨‹ç‚ºå»ºè­°è‰ç¨¿ï¼Œè«‹ç•™æ„åœ–ç‰‡çš†ç‚ºç¤ºæ„åœ–ï¼Œå¯¦éš›é¤é£Ÿ/ä½å®¿ä»¥æœ€çµ‚è¡Œç¨‹ç‚ºæº–ã€‚</p>
        </footer>
    </div>

    <!-- Logic -->
    <script>
        // --- å…¨åŸŸè®Šæ•¸ ---
        const FALLBACK_RATE = 0.22; 
        let currentExchangeRate = FALLBACK_RATE; 
        let activeMainTab = 'home'; 
        let activeDayId = 'day-1'; 
        
        // --- è¡Œç¨‹è³‡æ–™ ---
        const DEFAULT_ITINERARY_DATA = [
            {
                id: 1, title: "02/20ï¼šæœ­å¹Œå•Ÿç¨‹ âœˆï¸", subtitle: "ã€åˆè­˜æœ­å¹Œã€‘æ©Ÿå ´ç¾é£Ÿé–‹å ´ï¼Œéš¨å¾Œç›´å¥”å¸‚å€ã€‚", location: "æœ­å¹Œ, æ—¥æœ¬", 
                details: [
                    { time: "04:00", description: "æ¡ƒåœ’æ©Ÿå ´ Terminal 1 è¾¦ç†å ±åˆ°æ‰‹çºŒèˆ‡è¡Œææ‰˜é‹ã€‚", query: "æ¡ƒåœ’æ©Ÿå ´ Terminal 1", jpName: "å°æ¹¾æ¡ƒåœ’å›½éš›ç©ºæ¸¯ ç¬¬1ã‚¿ãƒ¼ãƒŸãƒŠãƒ«", address: "æ¡ƒåœ’å¸‚å¤§åœ’å€èˆªç«™å—è·¯15è™Ÿ", hours: "24å°æ™‚é–‹æ”¾" },
                    { 
                        time: "06:20", 
                        description: "å¾æ¡ƒåœ’æ©Ÿå ´ç¬¬ä¸€èˆªå»ˆ (T1) æ­ä¹˜**è™èˆª IT 234** é£›å¾€åŒ—æµ·é“æ–°åƒæ­²æ©Ÿå ´ã€‚", 
                        query: "æ¡ƒåœ’åœ‹éš›æ©Ÿå ´ç¬¬ä¸€èˆªå»ˆ", 
                        jpName: "å°æ¹¾æ¡ƒåœ’å›½éš›ç©ºæ¸¯ ç¬¬1ã‚¿ãƒ¼ãƒŸãƒŠãƒ«", 
                        address: "æ¡ƒåœ’å¸‚å¤§åœ’å€èˆªç«™å—è·¯15è™Ÿ (ç¬¬ä¸€èˆªå»ˆ)", 
                        hours: "èˆªç­æ™‚é–“ä¾èˆªç©ºå…¬å¸å…¬å‘Š", 
                        flight: "é£›è¡Œæ™‚é–“ 3å°æ™‚35åˆ†",
                        aircraft: "Airbus A320 / A320neo (å–®èµ°é“)"
                    },
                    { time: "10:55", description: "æŠµé”**åŒ—æµ·é“æ–°åƒæ­²æ©Ÿå ´**ï¼Œè¾¦ç†å…¥å¢ƒæ‰‹çºŒã€‚", query: "æ–°åƒæ­²æ©Ÿå ´", jpName: "æ–°åƒæ­³ç©ºæ¸¯", address: "æ—¥æœ¬ã€ã€’066-0012 åŒ—æµ·é“åƒæ­³å¸‚ç¾ã€…", hours: "åœ‹å…§ç·š 6:20-23:00" },
                    
                    { 
                        time: "12:00", 
                        description: "æ­¥è¡Œè‡³åœ‹å…§ç·šèˆªå»ˆ 3F **åŒ—æµ·é“æ‹‰éºµé“å ´** æˆ–ç¾é£Ÿè¡—äº«ç”¨åˆé¤ (æ¨è–¦ï¼šä¸€å¹»æ‹‰éºµã€åå‹è±šä¸¼)ã€‚", 
                        query: "åŒ—æµ·é“æ‹‰éºµé“å ´", 
                        jpName: "åŒ—æµ·é“ãƒ©ãƒ¼ãƒ¡ãƒ³é“å ´", 
                        address: "æ–°åƒæ­²æ©Ÿå ´åœ‹å…§ç·šèˆªå»ˆ 3F", 
                        hours: "10:00-21:00"
                    },

                    { 
                        time: "13:30", 
                        description: "åƒé£½å¾Œå‰å¾€é£¯åº—ï¼š<br>1. **JR å¿«é€Ÿ Airport** è‡³æœ­å¹Œç«™ï¼Œè½‰ä¹˜**åœ°éµå—åŒ—ç·š**è‡³ä¸­å³¶å…¬åœ’ç«™ã€‚<br>2. **æ©Ÿå ´å·´å£«** (ç´„80åˆ†ï¼Œç›´é”ä¸­å³¶å…¬åœ’ï¼Œå…è½‰è»Š)ã€‚", 
                        query: "JR æ–°åƒæ­²æ©Ÿå ´ç«™", 
                        jpName: "æ–°åƒæ­³ç©ºæ¸¯é§… / ç©ºæ¸¯é€£çµ¡ãƒã‚¹", 
                        address: "JR: B1F | å·´å£«: 1F ä¹˜è»Šè™•", 
                        hours: "JR: æ¯12åˆ†ä¸€ç­ | å·´å£«: æ¯å°æ™‚1-2ç­", 
                        ticket: "JR: Â¥1,150 | å·´å£«: Â¥1,300" 
                    },
                    
                    { time: "15:00", description: "æŠµé” **Vessel Inn æœ­å¹Œä¸­å³¶å…¬åœ’é£¯åº—** è¾¦ç† Check-in (å‰›å¥½æ˜¯å…¥ä½æ™‚é–“)ã€‚", query: "Vessel Inn æœ­å¹Œä¸­å³¶å…¬åœ’", jpName: "ãƒ™ãƒƒã‚»ãƒ«ã‚¤ãƒ³æœ­å¹Œä¸­å³¶å…¬åœ’", address: "åŒ—æµ·é“æœ­å¹Œå¸‚ä¸­å¤®åŒºå—ä¹æ¡è¥¿4-1-2", hours: "Check-in: 14:00" },
                    { time: "16:00", description: "æ”¾å¥½è¡Œæå¾Œï¼Œå‰å¾€é›ªç™½çš„**å¤§é€šå…¬åœ’**æ•£æ­¥æ‹ç…§ã€‚", query: "æœ­å¹Œå¤§é€šå…¬åœ’", jpName: "å¤§é€šå…¬åœ’", address: "æœ­å¹Œå¸‚ä¸­å¤®åŒºå¤§é€šè¥¿1ï½12ä¸ç›®", hours: "å…¨å¤©é–‹æ”¾" },
                    { time: "17:00", description: "ç™»ä¸Šåœ°æ¨™**æœ­å¹Œé›»è¦–å¡”**å±•æœ›å°ï¼Œä¿¯ç°æœ­å¹Œå¸‚å€å¤œæ™¯ã€‚", query: "æœ­å¹Œé›»è¦–å¡”", jpName: "ã•ã£ã½ã‚ãƒ†ãƒ¬ãƒ“å¡”", address: "æœ­å¹Œå¸‚ä¸­å¤®åŒºå¤§é€šè¥¿1ä¸ç›®", hours: "09:00-22:00", ticket: "å¤§äºº Â¥1,000" },
                    { time: "18:00", description: "è‡ªç”±é€›è¡—æ™‚é–“ï¼šå‰å¾€**æœ­å¹Œåœ°ä¸‹è¡—** (Aurora Town/Pole Town) æˆ– Parco ç™¾è²¨ã€‚", query: "æœ­å¹Œåœ°ä¸‹è¡—", jpName: "ã•ã£ã½ã‚åœ°ä¸‹è¡—", address: "æœ­å¹Œå¸‚ä¸­å¤®åŒºå¤§é€š", hours: "10:00-20:00" },
                    { time: "19:00", description: "åœ¨ç¾é£Ÿèˆ‡è³¼ç‰©å¤©å ‚**ç‹¸å°è·¯å•†åº—è¡—**è‡ªç”±æ´»å‹•ï¼Œäº«å—æ—¥å¼æ™šé¤ã€‚", query: "æœ­å¹Œç‹¸å°è·¯å•†åº—è¡—", jpName: "ç‹¸å°è·¯å•†åº—è¡—", address: "æœ­å¹Œå¸‚ä¸­å¤®åŒºå—2ãƒ»3æ¡è¥¿1ï½7ä¸ç›®", hours: "å¤§éƒ¨åˆ†åº—å®¶ 10:00-20:00" },
                    { time: "20:30", description: "å‰å¾€ **#C-pla ç‹¸å°è·¯5ä¸ç›®åº—** ç›¡æƒ…æ‰­è›‹ï¼(åŒ—æµ·é“æœ€å¤§ç´šæ‰­è›‹å°ˆè³£åº—)", query: "#C-pla ç‹¸å°è·¯5ä¸ç›®åº—", jpName: "#C-pla ç‹¸å°è·¯5ä¸ç›®åº—", address: "åŒ—æµ·é“æœ­å¹Œå¸‚ä¸­å¤®åŒºå—3æ¡è¥¿5ä¸ç›®27", hours: "11:00-23:00" }
                ],
                breakfast: "æº«æš–çš„å®¶ / æ©Ÿä¸Šè‡ªç†", lunch: "æ©Ÿå ´åœ‹å…§ç·šç¾é£Ÿ (æ‹‰éºµ/è±šä¸¼)", dinner: "ç‹¸å°è·¯è‡ªç†", lodging: "Vessel Innæœ­å¹Œä¸­å³¶å…¬åœ’é£¯åº—"
            },
            {
                id: 2, title: "02/21ï¼šä¼éµï¼é›ªä¸Šæ´»å‹•ï¼æº«æ³‰ ğŸ§", subtitle: "ã€å†°é›ªæ¨‚åœ’ã€‘æ•´æ—¥ç²¾å½©æ´»å‹•ï¼Œä»¥æº«æ³‰è§£é™¤ç–²å‹ã€‚", warning: "åœ˜é«”å·´å£«è¡Œç¨‹ï¼š07:40JRæœ­å¹ŒåŒ—å£é›†åˆï¼Œæ¯äººé™å¸¶ä¸€ä»¶å¤§å‹è¡Œæã€‚<br>âš ï¸ æ—¥æœ¬å¸æ©Ÿå·¥æ™‚æ§ç®¡åš´æ ¼,åˆ‡å‹¿é²åˆ°, ä»¥å…è¢«ä¸ŸåŒ…", location: "æ—­å·, æ—¥æœ¬", 
                details: [
                    { time: "08:00", description: "æ­ä¹˜å°ˆå±¬å·´å£«å‰å¾€**æ—­å±±å‹•ç‰©åœ’**ï¼Œè§€è³å†¬å­£é™å®šçš„ä¼éµæ•£æ­¥ã€‚", query: "æ—­å±±å‹•ç‰©åœ’", jpName: "æ—­å·å¸‚æ—­å±±å‹•ç‰©åœ’", address: "åŒ—æµ·é“æ—­å·å¸‚æ±æ—­å·ç”ºå€‰æ²¼", hours: "å†¬å­£é–‹åœ’: 10:30-15:30", ticket: "å¤§äºº Â¥1,000" },
                    { time: "12:00", description: "åˆé¤æ™‚é–“ (ç„—çƒ¤èƒèŸ¹æµ·é®®é™¶æ¿ç‡’å¾¡è†³)ã€‚", query: "æ—­å·åˆé¤åœ°é»", jpName: "æ—­å·ãƒ©ãƒ³ãƒ", address: "æ—­å·å¸‚å€ / å‹•ç‰©åœ’å‘¨é‚Š", hours: "åˆé¤æ™‚æ®µ" },
                    { time: "14:00", description: "å‰å¾€é›ªä¸Šæ¨‚åœ’ï¼Œé«”é©—é›ªä¸Šæ‘©æ‰˜è»Šã€é›ªç›†ã€æ©¡çš®è‰‡ç­‰**åˆºæ¿€é›ªä¸Šæ´»å‹•**ã€‚", query: "åŒ—æµ·é“é›ªä¸Šæ¨‚åœ’", jpName: "ã´ã£ã·ã‚¹ã‚­ãƒ¼å ´ (æ¯”å¸ƒæ»‘é›ªå ´å‘¨é‚Š)", address: "åŒ—æµ·é“ä¸Šå·éƒ¡æ¯”å¸ƒç”ºåŒ—7ç·š17è™Ÿ", hours: "å†¬å­£é–‹æ”¾ 09:00-16:00" },
                    { time: "18:00", description: "å°ˆè»Šå‰å¾€**å±¤é›²å³½æº«æ³‰å€**ï¼Œäº«å—é£¯åº—å…§è±ªè¯æ™šé¤åŠæº«æ³‰ã€‚", query: "å±¤é›²å³½æº«æ³‰é£¯åº—", jpName: "å±¤é›²å³¡æ¸©æ³‰", address: "åŒ—æµ·é“ä¸Šå·éƒ¡ä¸Šå·ç”ºå±¤é›²å³¡", hours: "å…¥ä½æ™‚é–“é€šå¸¸ç‚º 15:00 å¾Œ" }
                ],
                breakfast: "é£¯åº—å…§æ—©é¤", lunch: "ç„—çƒ¤èƒèŸ¹æµ·é®®é™¶æ¿ç‡’å¾¡è†³", dinner: "æº«æ³‰é£¯åº—è±ªè¯æ™šé¤", lodging: "**å±¤é›²å³½å‘¨é‚Šæº«æ³‰é£¯åº—**"
            },
            {
                id: 3, title: "02/22ï¼šç´‹åˆ¥ç ´å†°èˆ¹ï¼é…’é€ å·¡ç¦® ğŸš¢", subtitle: "ã€æµ·ä¹‹éœ‡æ’¼ã€‘æ¬£è³é„‚éœæ¬¡å…‹æµ·çš„æµå†°å¥‡æ™¯ã€‚", warning: "âš ï¸ åœ˜é«”å·´å£«è¡Œç¨‹ï¼šç´„ 18:00-19:00 è¿”æŠµ JR æœ­å¹Œè»Šç«™è§£æ•£", location: "ç´‹åˆ¥, æ—¥æœ¬", 
                details: [
                    { time: "08:30", description: "åƒè§€**éŠ€æ²³æµæ˜Ÿç€‘å¸ƒ** (å†¬å­£æ™¯è§€)ã€‚", query: "éŠ€æ²³æµæ˜Ÿç€‘å¸ƒ", jpName: "éŠ€æ²³ãƒ»æµæ˜Ÿã®æ»", address: "åŒ—æµ·é“ä¸Šå·éƒ¡ä¸Šå·ç”ºå±¤é›²å³¡", hours: "å…¨å¤©é–‹æ”¾" },
                    { time: "10:30", description: "é‡é ­æˆ²ï¼šæŠµé”ç´‹åˆ¥ï¼Œæ­ä¹˜**ç ´å†°èˆ¹** (GARINKO è™Ÿ) é«”é©—ç ´å†°ã€‚", query: "ç´‹åˆ¥ GARINKO è™Ÿ ç ´å†°èˆ¹", jpName: "æµæ°·ç •æ°·èˆ¹ã‚¬ãƒªãƒ³ã‚³å·", address: "åŒ—æµ·é“ç´‹åˆ¥å¸‚æµ·æ´‹å…¬åœ’1ç•ªåœ°", hours: "å†¬å­£å‡ºèˆª 09:00-15:00", ticket: "å¤§äºº Â¥5,000 (é ç´„åˆ¶)" },
                    { time: "12:30", description: "è±ªè¯èŸ¹è…³å¹²è²ç«¯çˆç‡’å¥—é¤åˆé¤ã€‚", query: "ç´‹åˆ¥æµ·é®®é¤å»³", jpName: "ç´‹åˆ¥æµ·é®®æ–™ç†", address: "ç´‹åˆ¥å¸‚æµ·æ´‹å…¬åœ’å‘¨é‚Š", hours: "åˆé¤æ™‚æ®µ" },
                    { time: "14:30", description: "æ–‡åŒ–é«”é©—ï¼šåƒè§€**æ—­å·ç”·å±±é…’é€ **ï¼Œäº†è§£æ¸…é…’é‡€è£½éç¨‹ã€‚", query: "æ—­å·ç”·å±±é…’é€ ", jpName: "ç”·å±±é…’é€ ã‚Šè³‡æ–™èˆ˜", address: "åŒ—æµ·é“æ—­å·å¸‚æ°¸å±±2æ¡7ä¸ç›®1-33", hours: "09:00-17:00" },
                    { time: "18:00", description: "è¿”å›æœ­å¹Œå¸‚å€é£¯åº—è¾¦ç†å…¥ä½ï¼Œæ™šé¤è‡ªç†ã€‚", query: "æœ­å¹Œå¸‚å€é£¯åº—", jpName: "æœ­å¹Œå¸‚å†…ãƒ›ãƒ†ãƒ«", address: "æœ­å¹Œå¸‚ä¸­å¿ƒ", hours: "å…¥ä½ 15:00 å¾Œ" }
                ],
                breakfast: "é£¯åº—å…§æ—©é¤", lunch: "è±ªè¯èŸ¹è…³å¹²è²ç«¯çˆç‡’å¥—é¤", dinner: "æœ­å¹Œå¸‚å€è‡ªç†", lodging: "æœ­å¹Œè’™ç‰¹åˆ©åŸƒå¾·çˆ¾éœå¤«é…’åº—"
            },
            {
                id: 4, title: "02/23ï¼šå°æ¨½é‹æ²³ï¼å¤©ç‹—å±±å¤œæ™¯ ğŸ””", subtitle: "ã€æµªæ¼«å°æ¨½ã€‘å¾æ­·å²é‹æ²³åˆ°ç™¾è¬å¤œæ™¯ï¼Œç›¡æƒ…äº«å—å°æ¨½çš„æ—¥èˆ‡å¤œã€‚", location: "å°æ¨½, æ—¥æœ¬", 
                details: [
                    { time: "10:00", description: "å¾æœ­å¹Œæ­ä¹˜ JR å‰å¾€å°æ¨½ã€‚", query: "å°æ¨½ JR ç«™", jpName: "å°æ¨½é§…", address: "å°æ¨½å¸‚ç¨»ç©—2ä¸ç›®", hours: "05:30-23:30" },
                    { time: "11:00", description: "**å°æ¨½é‹æ²³**ï¼šæ²¿è‘—é‹æ²³é‚Šæ•£æ­¥ï¼Œæ‹æ”ç¶“å…¸å€‰åº«ç¾¤ã€‚", query: "å°æ¨½é‹æ²³", jpName: "å°æ¨½é‹æ²³", address: "åŒ—æµ·é“å°æ¨½å¸‚æ¸¯ç”º", hours: "å…¨å¤©é–‹æ”¾" },
                    { time: "12:30", description: "åˆé¤ï¼šå°æ¨½å£½å¸æˆ–è‡ªç†ã€‚", query: "å°æ¨½å£½å¸åº—", jpName: "å°æ¨½å¯¿å¸å±‹é€šã‚Š", address: "å°æ¨½å¯¿å¸å±‹é€šã‚Š", hours: "ç´„ 11:00-21:00" },
                    { time: "14:00", description: "åƒè§€**åŒ—ä¸€ç¡å­é¤¨**èˆ‡**éŸ³æ¨‚ç›’åšç‰©é¤¨**ï¼Œæ„Ÿå—æ‡·èˆŠæ°£æ¯ã€‚", query: "å°æ¨½éŸ³æ¨‚ç›’åšç‰©é¤¨ åŒ—ä¸€ç¡å­é¤¨", jpName: "åŒ—ä¸€ç¡å­ãƒ»å°æ¨½ã‚ªãƒ«ã‚´ãƒ¼ãƒ«å ‚", address: "å°æ¨½å¸‚ä½å‰ç”º4-1", hours: "09:00-18:00" },
                    { time: "16:30", description: "å‰å¾€**å¤©ç‹—å±±çºœè»Š**ï¼Œæ¬£è³åŒ—æµ·é“ä¸‰å¤§å¤œæ™¯ä¹‹ä¸€ã€‚", query: "å¤©ç‹—å±±çºœè»Š", jpName: "å°æ¨½å¤©ç‹—å±±ãƒ­ãƒ¼ãƒ—ã‚¦ã‚¨ã‚¤", address: "åŒ—æµ·é“å°æ¨½å¸‚æœ€ä¸Š2-16-15", hours: "09:00-21:00", ticket: "ä¾†å› Â¥1,600" },
                    { time: "18:30", description: "æ™šé¤ï¼šè¿”å›æœ­å¹Œå¾Œï¼Œå»ºè­°å‰å¾€æœ­å¹Œæ‹‰éºµå…±å’Œåœ‹ (è‡ªç†)ã€‚", query: "æœ­å¹Œæ‹‰éºµå…±å’Œåœ‹", jpName: "æœ­å¹Œã‚‰ï½ã‚ã‚“å…±å’Œå›½", address: "æœ­å¹Œå¸‚ä¸­å¤®å€ (ESTAé—œé–‰ï¼Œå¯è‡³å‘¨é‚Š)", hours: "11:00-22:00" }
                ],
                breakfast: "é£¯åº—å…§æ—©é¤", lunch: "å°æ¨½å£½å¸æˆ–è‡ªç†", dinner: "æœ­å¹Œæ‹‰éºµå…±å’Œåœ‹ (è‡ªç†)", lodging: "æœ­å¹Œè’™ç‰¹åˆ©åŸƒå¾·çˆ¾éœå¤«é…’åº—"
            },
            {
                id: 5, title: "02/24ï¼šç¥å®®ï¼ç™½è‰²æˆ€äººï¼ä¸‰å¤§èŸ¹ ğŸ›ï¸", subtitle: "ã€æ–‡åŒ–èˆ‡ç¾é£Ÿã€‘é«”é©—åŒ—æµ·é“ç¥å®®çš„èŠåš´èˆ‡ç™½è‰²æˆ€äººçš„ç«¥è©±ä¸–ç•Œã€‚", location: "æœ­å¹Œ, æ—¥æœ¬", 
                details: [
                    { time: "09:00", description: "ä¸Šåˆï¼šåƒæ‹œ**åŒ—æµ·é“ç¥å®®**ã€‚", query: "åŒ—æµ·é“ç¥å®®", jpName: "åŒ—æµ·é“ç¥å®®", address: "åŒ—æµ·é“æœ­å¹Œå¸‚ä¸­å¤®åŒºå®®ãƒ¶ä¸˜474", hours: "å†¬å­£: 07:00-16:00" },
                    { time: "10:30", description: "å‰å¾€å¤¢å¹»çš„**ç™½è‰²æˆ€äººå…¬åœ’**ï¼Œåƒè§€å·¥å» èˆ‡æ‹ç…§ã€‚", query: "ç™½è‰²æˆ€äººå…¬åœ’", jpName: "ç™½ã„æ‹äººãƒ‘ãƒ¼ã‚¯", address: "åŒ—æµ·é“æœ­å¹Œå¸‚è¥¿åŒºå®®ã®æ²¢2-2-11-36", hours: "10:00-17:00", ticket: "ä»˜è²»å€ å¤§äºº Â¥800" },
                    // [ä¿®æ­£] åˆé¤æ”¹ç‚ºæ¹¯å’–å“©
                    { time: "12:30", description: "å‰å¾€**æœ­å¹Œæ¹¯å’–å“©ååº— Suage+**ï¼Œäº«ç”¨åŒ—æµ·é“ç‰¹è‰²åˆé¤ã€‚", query: "Suage+", jpName: "ã‚¹ãƒ¼ãƒ—ã‚«ãƒ¬ãƒ¼ Suage+ (ã™ã‚ã’ãƒ—ãƒ©ã‚¹)", address: "åŒ—æµ·é“æœ­å¹Œå¸‚ä¸­å¤®åŒºå—4æ¡è¥¿5ä¸ç›®éƒ½å¿—æ¾ãƒ“ãƒ«2F", hours: "11:30-21:30" },
                    { time: "14:30", description: "å‰å¾€**æœ­å¹Œå•¤é…’åšç‰©é¤¨**ï¼Œæ¬£è³ç¾éº—çš„ç´…ç£šå»ºç¯‰èˆ‡å•¤é…’æ­·å²ã€‚", query: "æœ­å¹Œå•¤é…’åšç‰©é¤¨", jpName: "ã‚µãƒƒãƒãƒ­ãƒ“ãƒ¼ãƒ«åšç‰©é¤¨", address: "åŒ—æµ·é“æœ­å¹Œå¸‚æ±åŒºåŒ—7æ¡æ±9ä¸ç›®1-1", hours: "11:00-18:00 (é€±ä¸€ä¼‘)", ticket: "å…¥é¤¨å…è²» (è©¦é£²ä»˜è²»)" },
                    { time: "16:00", description: "å‰å¾€ä½æ–¼ Norbesa çš„ **Gashapon Bandai å®˜æ–¹å•†åº—**ï¼Œé€™è£¡æœ‰è±å¯Œçš„è¬ä»£æ­£ç‰ˆæ‰­è›‹ï¼", query: "Gashapon Bandai Official Shop Sapporo Norbesa", jpName: "ã‚¬ã‚·ãƒ£ãƒãƒ³ãƒãƒ³ãƒ€ã‚¤ã‚ªãƒ•ã‚£ã‚·ãƒ£ãƒ«ã‚·ãƒ§ãƒƒãƒ— æœ­å¹Œãƒãƒ«ãƒ™ã‚µåº—", address: "åŒ—æµ·é“æœ­å¹Œå¸‚ä¸­å¤®åŒºå—3æ¡è¥¿5-1-1 ãƒãƒ«ãƒ™ã‚µ 1F", hours: "11:00-23:00" },
                    { time: "19:00", description: "æ™šé¤ï¼šå»ºè­°äº«å—ç¶“å…¸çš„**ä¸‰å¤§èŸ¹åƒåˆ°é£½** (å¸ç‹èŸ¹ã€æ¾è‘‰èŸ¹ã€æ¯›èŸ¹) (è‡ªç†)ã€‚", query: "æœ­å¹Œä¸‰å¤§èŸ¹åƒåˆ°é£½", jpName: "ä¸‰å¤§ã‚«ãƒ‹é£Ÿã¹æ”¾é¡Œ", address: "æœ­å¹Œå¸‚å€", hours: "æ™šé¤æ™‚æ®µ" }
                ],
                breakfast: "é£¯åº—å…§æ—©é¤", lunch: "æ¹¯å’–å“© (Suage+)", dinner: "ä¸‰å¤§èŸ¹åƒåˆ°é£½ (è‡ªç†)", lodging: "æœ­å¹Œè’™ç‰¹åˆ©åŸƒå¾·çˆ¾éœå¤«é…’åº—"
            },
            {
                id: 6, title: "02/25ï¼šæœ€çµ‚æ¡è²·ï¼è¿”å®¶ ğŸ ", subtitle: "ã€å®Œç¾å¥é»ã€‘è¼•é¬†è¡€æ‹šå¾Œï¼Œå¸¶è‘—æ»¿æ»¿å›æ†¶è¸ä¸Šæ­¸é€”ã€‚", location: "æ–°åƒæ­²æ©Ÿå ´, æ—¥æœ¬", 
                details: [
                    { time: "10:00", description: "é€€æˆ¿å¾Œï¼Œå‰å¾€**ä¸‰äº•OUTLETè³¼ç‰©ä¸­å¿ƒ**æˆ– Rera Outletã€‚", query: "æœ­å¹Œä¸‰äº•OUTLETè³¼ç‰©ä¸­å¿ƒ", jpName: "ä¸‰äº•ã‚¢ã‚¦ãƒˆãƒ¬ãƒƒãƒˆãƒ‘ãƒ¼ã‚¯ æœ­å¹ŒåŒ—åºƒå³¶", address: "åŒ—æµ·é“åŒ—å»£å³¶å¸‚å¤§æ›²å¹¸ç”º3-7-6", hours: "10:00-20:00" },
                    { time: "12:00", description: "åœ¨ OUTLET å…§äº«ç”¨åˆé¤ã€‚", query: "OUTLET é¤å»³", jpName: "ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³", address: "Outlet ç¾é£Ÿè¡—", hours: "10:30-21:00" },
                    { time: "13:30", description: "é›†åˆå‰å¾€æ–°åƒæ­²æ©Ÿå ´ã€‚", query: "æ–°åƒæ­²æ©Ÿå ´", jpName: "æ–°åƒæ­³ç©ºæ¸¯", address: "Bibi, Chitose", hours: "24å°æ™‚" },
                    
                    // [æ–°å¢æ©Ÿå‹è³‡è¨Šèˆ‡èˆªå»ˆ]
                    { 
                        time: "14:40", 
                        description: "æ­ä¹˜**è¯èˆª CI 131** ç­æ©Ÿè¿”å›å°åŒ— (æŠµé” T2)ã€‚", 
                        query: "æ–°åƒæ­²æ©Ÿå ´", 
                        jpName: "æ–°åƒæ­³ç©ºæ¸¯ å›½éš›ç·šã‚¿ãƒ¼ãƒŸãƒŠãƒ«", 
                        address: "åœ‹éš›ç·šèˆªå»ˆ (æŠµé”æ¡ƒåœ’ç¬¬ä¸€èˆªå»ˆ)", 
                        hours: "èˆªç­æ™‚é–“", 
                        flight: "é£›è¡Œæ™‚é–“ 4å°æ™‚10åˆ†",
                        aircraft: "Boeing 777-300ER (å»£é«”å®¢æ©Ÿ)"
                    },
                    { time: "18:15", description: "æŠµé”æ¡ƒåœ’åœ‹éš›æ©Ÿå ´ï¼Œæº«æš–çš„å®¶ã€‚", query: "æ¡ƒåœ’åœ‹éš›æ©Ÿå ´", jpName: "æ¡ƒåœ’ç©ºæ¸¯", address: "æ¡ƒåœ’å¸‚", hours: "24å°æ™‚é–‹æ”¾" }
                ],
                breakfast: "é£¯åº—å…§æ—©é¤", lunch: "OUTLET ç°¡é¤ (è‡ªç†)", dinner: "æ©Ÿä¸Šç°¡é¤", lodging: "æº«æš–çš„å®¶"
            },
        ];
        
        let appItineraryData = [...DEFAULT_ITINERARY_DATA];

        // --- æ¸…å–®è³‡æ–™ ---
        const PREPARATION_LIST = {
            "ğŸªª é‡è¦è­‰ä»¶": [
                "è­·ç…§ (æœ‰æ•ˆæœŸé™éœ€6å€‹æœˆä»¥ä¸Š)",
                "VJW (Visit Japan Web) QR Code æˆªåœ–",
                "æ—¥å¹£ç¾éˆ” (å»ºè­°å¤šæ›å°é¡ï¼Œå¦‚åƒåœ“éˆ”)",
                "ä¿¡ç”¨å¡ (è‹¥æœ‰äº‹å…ˆè²·JRè¦å¸¶åŒå¼µå¡)",
                "æ—…éŠå¹³å®‰éšªä¿å–®",
                "å°ç£èº«åˆ†è­‰å½±æœ¬ (å‚™ç”¨)"
            ],
            "ğŸ”Œ é›»å­ç”¢å“": [
                "ç¶²å¡/eSIM (ç¢ºèªé–‹é€šæ—¥æœŸ)",
                "è¡Œå‹•é›»æº (ä½æº«è€—é›»å¿«ï¼Œå»ºè­°å¸¶2é¡†)",
                "å……é›»å™¨/å‚³è¼¸ç·š",
                "è½‰æ¥é ­ (æ—¥æœ¬ç‚ºé›™å­”æ‰æ’ï¼Œå°ç£é€šç”¨)",
                "ç›¸æ©Ÿ/åº•ç‰‡ (ä½æº«éœ€æ³¨æ„é›»æ± ä¿æš–)",
                "å–å¡é‡"
            ],
            "ğŸ‘• å€‹äººè¡£ç‰© (å«ä¿æš–)": [
                "æ›æ´—è¡£ç‰© (å…§è¡£è¤²/ä¸Šè¡£/è¥ªå­)",
                "ç¡è¡£ (é›–ç„¶é£¯åº—æœ‰æµ´è¡£ï¼Œä½†æ€•å†·æˆ–ä¸ç¿’æ…£å¯è‡ªå‚™)",
                "é˜²é¢¨é˜²æ°´ç¾½çµ¨å¤–å¥— (æ´‹è”¥å¼ç©¿æ³•)",
                "ç™¼ç†±è¡£/è¤² (Heatech æ¥µæš–/è¶…æ¥µæš–)",
                "ä¸€èˆ¬é•·è¤²/åˆ·æ¯›è¤²",
                "é˜²æ»‘é›ªé´ (éå¸¸é‡è¦ï¼è¦æœ‰æ·±åˆ»ç´‹)",
                "é›ªåœ°é˜²æ»‘é‹å¥— (è‹¥ç„¡é›ªé´ï¼Œå»ºè­°æº–å‚™æ–¹ä¾¿ç©¿è„«æ¬¾)",
                "åšæ¯›è¥ª/ç¾Šæ¯›è¥ª (å»ºè­°å¤šå¸¶)",
                "æ¯›å¸½ (éœ€èƒ½è“‹ä½è€³æœµ)",
                "åœå·¾/è„–åœ",
                "é˜²æ½‘æ°´æ‰‹å¥— (ç©é›ª/æ»‘æ‰‹æ©Ÿæ–¹ä¾¿)"
            ],
            "ğŸ§´ ç›¥æ´—/ä¿é¤Š/åŒ–å¦": [
                "åŒ–å¦å“ (åº•å¦/å½©å¦)",
                "ä¿é¤Šå“ (å»ºè­°å¸¶æ²¹é¡/éœœé¡ï¼Œæ—¥æœ¬æ¥µä¹¾)",
                "å¸å¦ä¹³ã€æ²¹",
                "æ´—é¢ä¹³",
                "ç‰™åˆ·/ç‰™è† (æ—¥æœ¬æå€¡ç’°ä¿ï¼Œéƒ¨åˆ†é£¯åº—ä¸æä¾›)",
                "ç‰™ç·šæ£’/æ£‰èŠ±æ£’",
                "æ´—/æ½¤é«®ä¹³ (é£¯åº—æœ‰ï¼Œå¯è‡ªå‚™æ…£ç”¨)",
                "é«˜ä¿æ¿•ä¹³æ¶²/è­·æ‰‹éœœ (æ—¥æœ¬æ¥µä¹¾)",
                "è­·å”‡è†",
                "éš±å½¢çœ¼é¡/è—¥æ°´"
            ],
            "ğŸ’Š å¸¸å‚™è—¥å“": [
                "æ„Ÿå†’è—¥ (å«é€€ç‡’)",
                "è…¸èƒƒè—¥",
                "æ­¢ç—›è—¥",
                "æšˆè»Šè—¥ (æ­å·´å£«/ç ´å†°èˆ¹å¿…å‚™)",
                "OKç¹ƒ/å¤–å‚·è—¥è†"
            ],
            "ğŸ’ å…¶ä»–å¿…å‚™": [
                "å£ç½© (æ©Ÿä¸Š/äººå¤šè™•é˜²è­·)",
                "é«’è¡£è¢‹/æ”¶ç´è¢‹",
                "ç©ºæ°´å£º (æ—¥æœ¬æ°´é¾é ­å¯ç”Ÿé£²ï¼Œä½†æœ‰ç“¶å­æ–¹ä¾¿)",
                "æš–æš–åŒ… (è²¼å¼/æ‰‹æ¡å¤šæº–å‚™)",
                "å¢¨é¡ (é›ªåœ°åå…‰å¼·ï¼Œé˜²é›ªç›²)",
                "æ‘ºç–Šå‚˜ (ä»¥é˜²æ¿•é›ª/æš´é¢¨é›ª)",
                "è³¼ç‰©è¢‹ (ç’°ä¿è¢‹)",
                "è¡£ç‰©å£“ç¸®è¢‹ (åšé‡è¡£ç‰©å¥½æ”¶ç´)",
                "æ¿•ç´™å·¾/é…’ç²¾æ£‰ç‰‡"
            ]
        };

        // --- æ ¸å¿ƒé‚è¼¯ ---
        function initApp() {
            // æ›è¼‰å…¨åŸŸå‡½å¼
            window.openModal = openModal;
            window.closeModal = closeModal;
            window.openInGoogleMaps = openInGoogleMaps;
            window.switchMainView = switchMainView;
            window.switchDayView = switchDayView;
            window.convertCurrency = convertCurrency;
            window.toggleCheck = toggleCheck; // æ–°å¢å‹¾é¸åˆ‡æ›åŠŸèƒ½

            renderMainTabs();
            renderDayTabs();
            switchMainView('home');
        }

        const ACTIVITY_KEYWORDS = ["è™èˆª IT 234", "è¯èˆª CI 131", "åˆºæ¿€é›ªä¸Šæ´»å‹•", "ç ´å†°èˆ¹", "ä¸‰å¤§èŸ¹åƒåˆ°é£½", "å¤©ç‹—å±±çºœè»Š", "ç™½è‰²æˆ€äººå…¬åœ’"];
        const LOCATION_KEYWORDS = ["æ—­å±±å‹•ç‰©åœ’", "å°æ¨½é‹æ²³", "LeTAO ç¸½åº—", "æœ­å¹Œé›»è¦–å¡”", "ç‹¸å°è·¯å•†åº—è¡—", "éŠ€æ²³æµæ˜Ÿç€‘å¸ƒ", "æ—­å·ç”·å±±é…’é€ ", "åŒ—ä¸€ç¡å­é¤¨", "éŸ³æ¨‚ç›’åšç‰©é¤¨", "åŒ—æµ·é“ç¥å®®", "æœ­å¹Œå ´å¤–å¸‚å ´", "ä¸‰äº•OUTLETè³¼ç‰©ä¸­å¿ƒ", "å¤§é€šå…¬åœ’", "å±¤é›²å³½æº«æ³‰é£¯åº—", "éŸ³æ¨‚ç›’å ‚", "æœ­å¹Œåœ°ä¸‹è¡—", "#C-pla ç‹¸å°è·¯5ä¸ç›®åº—", "Gashapon Bandai å®˜æ–¹å•†åº—", "æœ­å¹Œå•¤é…’åšç‰©é¤¨", "Suage+", "Vessel Inn æœ­å¹Œä¸­å³¶å…¬åœ’é£¯åº—"];

        const highlightText = (text, item, isClickable = false) => {
            return text.replace(/\*\*(.*?)\*\*/g, (match, p1) => {
                if (isClickable && item) {
                    const safeTitle = p1.replace(/'/g, "\\'").replace(/"/g, '&quot;');
                    const safeAddress = (item.address || "åœ°å€è©³æƒ…è«‹æŸ¥è©¢").replace(/'/g, "\\'").replace(/"/g, '&quot;');
                    const safeHours = (item.hours || "ç‡Ÿæ¥­æ™‚é–“è«‹æŸ¥è©¢").replace(/'/g, "\\'").replace(/"/g, '&quot;');
                    const safeQuery = (item.query || p1).replace(/'/g, "\\'").replace(/"/g, '&quot;');
                    const safeJpTitle = (item.jpName || "").replace(/'/g, "\\'").replace(/"/g, '&quot;');
                    const safeTicket = (item.ticket || "").replace(/'/g, "\\'").replace(/"/g, '&quot;');
                    // [æ–°å¢] å®‰å…¨è™•ç†æ©Ÿå‹æ¬„ä½
                    const safeAircraft = (item.aircraft || "").replace(/'/g, "\\'").replace(/"/g, '&quot;');
                    
                    return `<span class="highlight-text-clickable" onclick="openModal('${safeTitle}', '${safeAddress}', '${safeHours}', '${safeTicket}', '${safeQuery}', '${safeJpTitle}', '${safeAircraft}')">${p1}</span>`;
                } else {
                    const isActivity = ACTIVITY_KEYWORDS.some(keyword => p1.includes(keyword));
                    const isLocation = LOCATION_KEYWORDS.some(keyword => p1.includes(keyword));
                    let className = "location-text-static"; 
                    if (isActivity) className = "highlight-text-activity";
                    else if (isLocation) className = "highlight-text-location";
                    return `<span class="${className}">${p1}</span>`;
                }
            });
        };

        // [æ›´æ–°] openModal å¢åŠ  aircraft åƒæ•¸
        window.openModal = function(title, address, hours, ticket, query, jpTitle, aircraft) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-jp-name').textContent = jpTitle || ""; 
            document.getElementById('modal-address').textContent = address;
            document.getElementById('modal-hours').textContent = hours;
            
            // è™•ç†é–€ç¥¨é¡¯ç¤º (åªåœ¨ Modal å…§)
            const ticketRow = document.getElementById('modal-ticket-row');
            const ticketText = document.getElementById('modal-ticket');
            if (ticket && ticket !== 'undefined' && ticket !== '') {
                ticketText.textContent = ticket;
                ticketRow.classList.remove('hidden');
            } else {
                ticketRow.classList.add('hidden');
            }

            // [æ–°å¢] è™•ç†æ©Ÿå‹é¡¯ç¤º
            const aircraftRow = document.getElementById('modal-aircraft-row');
            const aircraftText = document.getElementById('modal-aircraft');
            if (aircraft && aircraft !== 'undefined' && aircraft !== '') {
                aircraftText.textContent = aircraft;
                aircraftRow.classList.remove('hidden');
            } else {
                aircraftRow.classList.add('hidden');
            }

            document.getElementById('modal-map-btn').onclick = function() { window.openInGoogleMaps(query); };
            document.getElementById('location-modal').classList.remove('hidden');
        };
        window.closeModal = function() { document.getElementById('location-modal').classList.add('hidden'); };
        window.openInGoogleMaps = function(query) {
            if (query) window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(query)}`, '_blank'); 
        }
        window.addEventListener('click', function(e) {
            if (e.target === document.getElementById('location-modal')) closeModal();
        });

        function renderMainTabs() {
            const container = document.getElementById('main-tabs');
            container.innerHTML = '';
            container.appendChild(createMainTab('ä¸»é ', 'home', `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l-2-2m2 2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 01-1 1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>`));
            container.appendChild(createMainTab('è©³ç´°è¡Œç¨‹', 'itinerary-group', `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h.01M7 12h.01M6 16h.01M9 16h.01M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>`));
            // æ–°å¢è¡Œå‰æº–å‚™ Tab
            container.appendChild(createMainTab('è¡Œå‰æº–å‚™', 'preparation', `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" /></svg>`));
        }
        
        function createMainTab(text, viewId, iconHtml) {
            const button = document.createElement('button');
            button.className = 'tab-item main-tab text-gray-700';
            button.innerHTML = iconHtml + text;
            button.onclick = () => switchMainView(viewId);
            button.setAttribute('data-view', viewId);
            return button;
        }

        function renderDayTabs() {
            const container = document.getElementById('day-tabs');
            container.innerHTML = '';
            appItineraryData.forEach(day => {
                const button = document.createElement('button');
                // [ç¢ºä¿] ä½¿ç”¨ tab-item + day-tab æ¨£å¼
                button.className = 'tab-item day-tab text-gray-600'; 
                button.textContent = `Day ${day.id}`;
                button.setAttribute('data-day-id', `day-${day.id}`);
                button.onclick = () => switchDayView(`day-${day.id}`);
                container.appendChild(button);
            });
        }

        function switchMainView(viewId) {
            activeMainTab = viewId;
            document.querySelectorAll('.main-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-view') === viewId) tab.classList.add('active');
            });
            const contentContainer = document.getElementById('dynamic-content');
            const dayTabsContainer = document.getElementById('day-tabs');
            const baseClasses = 'content-area bg-gray-50 px-4 sm:px-6';
            if (viewId === 'home') {
                contentContainer.className = baseClasses + ' py-8 sm:py-12';
                dayTabsContainer.style.display = 'none';
                contentContainer.innerHTML = renderHomeContent();
            } else if (viewId === 'itinerary-group') {
                contentContainer.className = baseClasses + ' pt-0 pb-8 sm:pb-12';
                dayTabsContainer.style.display = 'flex';
                switchDayView(activeDayId);
            } else if (viewId === 'preparation') {
                contentContainer.className = baseClasses + ' py-8 sm:py-12';
                dayTabsContainer.style.display = 'none';
                contentContainer.innerHTML = renderPreparationContent();
            }
        }

        function switchDayView(dayId) {
            activeDayId = dayId;
            document.querySelectorAll('.day-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-day-id') === dayId) tab.classList.add('active');
            });
            const dayNumber = parseInt(dayId.split('-')[1]);
            const dayData = appItineraryData.find(d => d.id === dayNumber);
            if (dayData) document.getElementById('dynamic-content').innerHTML = renderDayContent(dayData);
        }

        function convertCurrency() {
            const input = document.getElementById('jpy-input');
            const output = document.getElementById('twd-output');
            if (input && output) {
                const val = parseFloat(input.value);
                if (!isNaN(val)) {
                    output.textContent = `${Math.round(val * FALLBACK_RATE)} TWD`;
                    output.className = output.className.replace('text-gray-700', 'text-pink-700');
                } else {
                    output.textContent = '0 TWD';
                }
            }
        }

        function renderExchangeRateBlock() {
            return `<div id="exchange-rate-block" class="max-w-xs mx-auto p-2 my-2 bg-transparent"><p class="text-sm font-semibold text-gray-600 mb-2 text-center">ğŸ’µ JPY â‡Œ TWD å¿«é€Ÿè©¦ç®—</p><div class="flex space-x-2"><div class="flex-1"><input type="number" id="jpy-input" oninput="convertCurrency()" placeholder="æ—¥å¹£" class="w-full py-2 px-3 border border-gray-300 rounded-lg text-sm shadow-sm focus:ring-sky-500"></div><div id="twd-output" class="flex-1 flex items-center justify-end py-2 px-3 border border-gray-300 rounded-lg bg-gray-100 text-sm font-bold text-gray-700 text-right">0 TWD</div></div><div class="text-right text-xs text-gray-400 mt-1">åƒè€ƒåŒ¯ç‡: 0.22</div></div>`;
        }

        function renderHomeContent() {
            return `
                <div class="day-content p-8 sm:p-10 bg-white rounded-xl shadow-lg border border-gray-100 space-y-8">
                    <div>
                        <h3 class="text-2xl font-bold accent-color mb-3 border-b pb-2">âœˆï¸ èˆªç­è³‡è¨Š</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm font-medium p-2">
                            <!-- Outbound -->
                            <div class="bg-blue-50 p-4 rounded-lg border border-blue-100 shadow-sm">
                                <div class="font-bold text-lg text-[#2E4057] mb-3 flex items-center">
                                    <span class="mr-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plane-takeoff-icon lucide-plane-takeoff"><path d="M2 22h20"/><path d="M6.36 17.4 4 17l-2-4 1.1-.55a2 2 0 0 1 1.8 0l.17.1a2 2 0 0 0 1.8 0L8 12 5 6l.9-.45a2 2 0 0 1 2.09.2l4.02 3a2 2 0 0 0 2.1.2l4.19-2.06a2.41 2.41 0 0 1 1.73-.17L21 7a1.4 1.4 0 0 1 .87 1.99l-.38.76c-.23.46-.6.84-1.07 1.08L7.58 17.2a2 2 0 0 1-1.22.18Z"/></svg>
                                    </span> 
                                    å»ç¨‹ï¼šå°åŒ— â” æœ­å¹Œ
                                </div>
                                <div class="text-gray-700 space-y-2">
                                    <p class="flex justify-between border-b border-blue-100 pb-1">
                                        <span class="font-semibold text-gray-500">èˆªç­</span>
                                        <span class="font-bold text-gray-800">è™èˆª IT 234</span>
                                    </p>
                                    <p class="flex justify-between border-b border-blue-100 pb-1">
                                        <span class="font-semibold text-gray-500">æ™‚é–“</span>
                                        <span>06:20 - 10:55 (3h 35m)</span>
                                    </p>
                                    <p class="flex justify-between border-b border-blue-100 pb-1">
                                        <span class="font-semibold text-gray-500">èˆªå»ˆ</span>
                                        <span class="font-bold text-red-600">æ¡ƒåœ’æ©Ÿå ´ç¬¬ä¸€èˆªå»ˆ (T1)</span>
                                    </p>
                                    <p class="flex justify-between items-start">
                                        <span class="font-semibold text-gray-500 whitespace-nowrap mr-2">æ©Ÿå‹</span>
                                        <span class="text-right text-slate-600">Airbus A320 / A320neo<br><span class="text-xs text-gray-400">(å–®èµ°é“)</span></span>
                                    </p>
                                </div>
                            </div>

                            <!-- Inbound -->
                            <div class="bg-orange-50 p-4 rounded-lg border border-orange-100 shadow-sm">
                                <div class="font-bold text-lg text-[#2E4057] mb-3 flex items-center">
                                    <span class="mr-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plane-landing-icon lucide-plane-landing"><path d="M2 22h20"/><path d="M3.77 10.77 2 9l2-4.5 1.1.55c.55.28.9.84.9 1.45s.35 1.17.9 1.45L8 8.5l3-6 1.05.53a2 2 0 0 1 1.09 1.52l.72 5.4a2 2 0 0 0 1.09 1.52l4.4 2.2c.42.22.78.55 1.01.96l.6 1.03c.49.88-.06 1.98-1.06 2.1l-1.18.15c-.47.06-.95-.02-1.37-.24L4.29 11.15a2 2 0 0 1-.52-.38Z"/></svg>
                                    </span> 
                                    å›ç¨‹ï¼šæœ­å¹Œ â” å°åŒ—
                                </div>
                                <div class="text-gray-700 space-y-2">
                                    <p class="flex justify-between border-b border-orange-100 pb-1">
                                        <span class="font-semibold text-gray-500">èˆªç­</span>
                                        <span class="font-bold text-gray-800">è¯èˆª CI 131</span>
                                    </p>
                                    <p class="flex justify-between border-b border-orange-100 pb-1">
                                        <span class="font-semibold text-gray-500">æ™‚é–“</span>
                                        <span>14:40 - 18:15 (4h 10m)</span>
                                    </p>
                                    <p class="flex justify-between border-b border-orange-100 pb-1">
                                        <span class="font-semibold text-gray-500">èˆªå»ˆ</span>
                                        <span class="font-bold text-red-600">æ–°åƒæ­²æ©Ÿå ´ç¬¬ä¸€èˆªå»ˆ (T1)</span>
                                    </p>
                                    <p class="flex justify-between items-start">
                                        <span class="font-semibold text-gray-500 whitespace-nowrap mr-2">æ©Ÿå‹</span>
                                        <span class="text-right text-slate-600">Boeing 777-300ER<br><span class="text-xs text-gray-400">(å»£é«”å®¢æ©Ÿ)</span></span>
                                    </p>
                                </div>
                            </div>
                        </div>

                    </div>
                    ${renderExchangeRateBlock()} 
                    <div>
                        <h3 class="text-2xl font-bold accent-color mb-3 border-b pb-2">ğŸ¯ è¡Œç¨‹äº®é»</h3>
                        <ul class="space-y-3 pl-4 list-disc text-gray-700">
                            <li><strong class="text-sky-700">é›ªåœ°å¥‡è§€ï¼š</strong>æ­ä¹˜ç´‹åˆ¥${highlightText('**ç ´å†°èˆ¹**', {}, false)}ï¼Œè¿‘è·é›¢æ„Ÿå—é„‚éœæ¬¡å…‹æµ·çš„æµå†°éœ‡æ’¼ã€‚</li>
                            <li><strong class="text-sky-700">å‹•ç‰©æ˜æ˜Ÿï¼š</strong>å‰å¾€${highlightText('**æ—­å±±å‹•ç‰©åœ’**', {}, false)}ï¼Œè§€è³å†¬å­£é™å®šçš„ä¼éµé›ªåœ°æ•£æ­¥ã€‚</li>
                            <li><strong class="text-sky-700">æº«æ³‰ç™‚ç™’ï¼š</strong>å…¥ä½${highlightText('**å±¤é›²å³½æº«æ³‰é£¯åº—**', {}, false)}ï¼Œäº«å—æ—¥å¼è±ªè¯æœƒå¸­æ–™ç†èˆ‡å¤©ç„¶æº«æ³‰ã€‚</li>
                            <li><strong class="text-sky-700">æµªæ¼«æ•£ç­–ï¼š</strong>åœ¨${highlightText('**å°æ¨½é‹æ²³**', {}, false)}ã€${highlightText('**éŸ³æ¨‚ç›’å ‚**', {}, false)}äº«å—æµªæ¼«çš„è‡ªç”±æ™‚å…‰èˆ‡ç²¾ç·»ç”œé»ã€‚</li>
                            <li><strong class="text-sky-700">ç¾é£Ÿå¤©å ‚ï¼š</strong>ç‰¹åˆ¥å®‰æ’èŸ¹è…³æµ·é®®é™¶æ¿ç‡’ã€ä¸¦å»ºè­°é«”é©—${highlightText('**ä¸‰å¤§èŸ¹åƒåˆ°é£½**', {}, false)}ã€‚</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        // --- æ–°å¢è¡Œå‰æº–å‚™æ¸²æŸ“å‡½å¼ ---
        function renderPreparationContent() {
            let html = `
                <div class="day-content p-8 sm:p-10 bg-white rounded-xl shadow-lg border border-gray-100">
                    <h3 class="text-4xl font-black accent-color mb-3 border-b-2 pb-1">ğŸ’ è¡Œå‰æº–å‚™æ¸…å–®</h3>
                    <p class="text-gray-600 mb-6 text-lg">é‡å° 2 æœˆåŒ—æµ·é“é›ªå­£å„ªåŒ–ï¼Œè«‹å‹™å¿…ç¢ºèªä»¥ä¸‹ç‰©å“æ˜¯å¦å‚™é½Šã€‚</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            `;

            for (const category in PREPARATION_LIST) {
                html += `
                    <div class="bg-gray-50 p-5 rounded-xl border border-gray-200">
                        <h4 class="font-bold text-xl text-sky-800 mb-3 pb-2 border-b border-gray-300">${category}</h4>
                        <ul class="space-y-2">
                `;
                PREPARATION_LIST[category].forEach((item, index) => {
                    const uniqueId = `${category}-${index}`;
                    html += `
                        <li class="checklist-item flex items-start" onclick="toggleCheck('${uniqueId}')">
                            <input type="checkbox" id="${uniqueId}" class="checklist-checkbox mt-1 mr-3 flex-shrink-0 cursor-pointer pointer-events-none">
                            <span id="text-${uniqueId}" class="text-gray-700 font-medium leading-relaxed">${item}</span>
                        </li>
                    `;
                });
                html += `</ul></div>`;
            }

            html += `</div></div>`;
            return html;
        }

        function toggleCheck(id) {
            const checkbox = document.getElementById(id);
            const text = document.getElementById(`text-${id}`);
            if (checkbox && text) {
                checkbox.checked = !checkbox.checked;
                if (checkbox.checked) {
                    text.classList.add('checked-text');
                } else {
                    text.classList.remove('checked-text');
                }
            }
        }

        function renderDayContent(day) {
            const timeToMinutes = (timeStr) => {
                const [hours, minutes] = timeStr.split(':').map(Number);
                return hours * 60 + minutes;
            };
            
            const detailsHtml = day.details.map((item, index) => {
                let durationHtml = '';
                if (index < day.details.length - 1) {
                    const currentTime = timeToMinutes(item.time);
                    const nextTime = timeToMinutes(day.details[index + 1].time);
                    let diffMinutes = nextTime - currentTime;
                    if (diffMinutes < 0) diffMinutes += 24 * 60; 
                    const diffHours = Math.floor(diffMinutes / 60);
                    const remainingMinutes = diffMinutes % 60;
                    let durationText = '';
                    if (diffHours > 0) durationText += `${diffHours}å°æ™‚`;
                    if (remainingMinutes > 0 || diffHours === 0) durationText += `${remainingMinutes}åˆ†é˜`;
                    
                    // [ä¿®æ­£] ç§»é™¤ flight å¤–æ¡†ï¼Œæ”¹ç”¨ç´”æ–‡å­—+Icon
                    let connectorContent = '';
                    let lineStyle = 'w-0.5 h-6 bg-gray-300';
                    
                    if (item.flight) {
                        lineStyle = 'w-0.5 h-6 border-l-2 border-dashed border-gray-400';
                        connectorContent = `
                             <div class="flex items-center text-sky-600 text-xs font-bold my-1">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><path d="M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z"/></svg>
                                ${item.flight}
                             </div>
                        `;
                    } else {
                         connectorContent = `
                            <div class="relative text-gray-600 px-3 py-1 text-xs font-medium flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1 text-gray-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l3 3a1 1 0 001.414-1.414L11 9.586V6z" clip-rule="evenodd" /></svg>
                                é è¨ˆèŠ±è²»ï¼š${durationText}
                            </div>
                        `;
                    }

                    durationHtml = `
                        <div class="flex flex-col items-start ml-5 sm:ml-6 mt-1 mb-1">
                            <div class="${lineStyle} ml-3"></div>
                            ${connectorContent}
                            <div class="${lineStyle} ml-3"></div>
                        </div>
                    `;
                }

                // [ä¿®æ­£] ç§»é™¤è¡Œç¨‹å¡ç‰‡å³ä¸Šè§’çš„ ticketInfoï¼Œä¹Ÿç§»é™¤å³å´çš„åœ°åœ–æŒ‰éˆ•
                const activityBlock = `
                    <div class="bg-white p-4 rounded-xl shadow border border-gray-200 transition duration-300 hover:shadow-lg flex justify-between items-start relative">
                        <div class="flex-grow">
                            <p class="text-sm font-bold text-gray-500 mb-1 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 text-[#748DA6]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                ${item.time}
                            </p>
                            <p class="text-gray-800 text-base font-medium leading-normal">
                                ${highlightText(item.description, item, true)}
                            </p>
                        </div>
                    </div>
                `;
                
                return activityBlock + durationHtml;
            }).join('');
            
            const lodgingHtml = highlightText(day.lodging, {}, false);
            
            return `
                <div class="day-content p-8 sm:p-10 bg-white rounded-xl shadow-lg border border-gray-100">
                    <h3 class="text-4xl font-black accent-color mb-3 border-b-2 pb-1">${day.title}</h3>
                    <p class="text-red-600 font-semibold mb-4 text-lg">${day.warning ? `âš ï¸ ${day.warning}` : ''}</p>
                    <p class="text-gray-700 mb-6 font-medium text-xl leading-relaxed">${day.subtitle}</p>
                    ${detailsHtml}
                    <div class="meal-summary p-4 mt-8 rounded-lg text-base font-semibold grid grid-cols-1 sm:grid-cols-2 gap-2">
                        <div><span class="text-[#2E4057]">ğŸ³ æ—©é¤ï¼š</span> ${day.breakfast}</div>
                        <div><span class="text-[#2E4057]">ğŸœ åˆé¤ï¼š</span> ${day.lunch}</div>
                        <div><span class="text-[#2E4057]">ğŸ¥© æ™šé¤ï¼š</span> ${day.dinner}</div>
                        <div><span class="text-[#2E4057]">ğŸ¨ ä½å®¿ï¼š</span> ${lodgingHtml}</div>
                    </div>
                </div>
            `;
        }

        document.addEventListener('DOMContentLoaded', () => {
            initApp();
        });
    </script>
</body>
</html>