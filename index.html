<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ—æµ·é“å…­æ—¥éŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&family=Noto+Sans+JP:wght@400;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f1f5f9; }
        .header-bg { background-image: linear-gradient(135deg, #2E4057 0%, #748DA6 100%); }
        .accent-color { color: #0ea5e9; }
        
        .tab-item {
            padding: 8px 12px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            transition: all 0.2s;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            white-space: nowrap;
            border-radius: 0;
            font-size: 0.95rem;
        }
        
        .main-tab:hover { color: #0ea5e9; border-bottom-color: #0ea5e9; }
        .main-tab.active { border-bottom-color: #0ea5e9; color: #0ea5e9; font-weight: 700; background-color: #fff; }
        
        .day-tab { color: #64748b; background-color: transparent; }
        .day-tab:hover { color: #0284c7; background-color: #f8fafc; }
        .day-tab.active { border-bottom-color: #0284c7; color: #0284c7; font-weight: 700; background-color: #f0f9ff; }

        .content-area { animation: fadeIn 0.4s ease-in-out; min-height: 500px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        #location-modal { transition: opacity 0.2s ease-in-out; }
        #location-modal.hidden { opacity: 0; pointer-events: none; }
        #location-modal:not(.hidden) { opacity: 1; pointer-events: auto; }
        
        /* æ™‚é–“è»¸å®¹å™¨ */
        .timeline-col {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 3rem;       
            flex-shrink: 0;
        }
        
        /* å¯¦ç·š (ä¸€èˆ¬è¡Œç¨‹) */
        .timeline-line-solid {
            position: absolute;
            top: 0; 
            bottom: -3rem; 
            left: 50%; 
            width: 2px;
            transform: translateX(-50%);
            background-color: #cbd5e1; /* slate-300 */
            z-index: 0;
        }

        /* è™›ç·š (äº¤é€šè¡Œç¨‹) */
        .timeline-line-dashed {
            position: absolute;
            top: 0; 
            bottom: -3rem; 
            left: 50%; 
            width: 0;
            transform: translateX(-50%);
            border-left: 2px dashed #94a3b8; /* slate-400 */
            z-index: 0;
        }

        /* é¦–å°¾ä¿®æ­£ */
        .first-item .timeline-line-solid, .first-item .timeline-line-dashed { top: 1.5rem; }
        .last-item .timeline-line-solid, .last-item .timeline-line-dashed { bottom: auto; height: 1.5rem; }

        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
        
        .checklist-item { cursor: pointer; transition: all 0.2s; }
        .checklist-item:hover { background-color: #f0f9ff; }
        .checklist-checkbox { accent-color: #00A8A0; width: 1.25rem; height: 1.25rem; }
        .checked-text { text-decoration: line-through; color: #9ca3af; opacity: 0.7; }
        
        .highlight-text-clickable { font-weight: 700; color: #0284c7; background-color: #e0f2fe; padding: 0 2px; border-radius: 2px; cursor: pointer; text-decoration: underline; }
    </style>
</head>
<body class="min-h-screen">

    <div id="app" class="max-w-4xl mx-auto bg-gray-50 shadow-2xl relative min-h-screen">
        
        <!-- Modal -->
        <div id="location-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm hidden p-4">
            <div class="bg-white rounded-2xl shadow-2xl max-w-sm w-full p-6 relative transform transition-all scale-100 border border-gray-100">
                <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 bg-gray-100 rounded-full p-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
                <div class="mb-5 border-b border-gray-100 pb-4 pr-8">
                    <h3 id="modal-title" class="text-2xl font-bold text-gray-800 leading-tight"></h3>
                    <p id="modal-jp-name" class="text-sm text-sky-600 font-medium font-['Noto_Sans_JP'] mt-1">Japanese Name</p>
                </div>
                <div class="space-y-4">
                    <div class="flex items-start"><span class="text-xl mr-3 mt-0.5 text-gray-400">ğŸ“</span><div><p class="text-xs font-bold text-gray-400 uppercase tracking-wide">åœ°å€</p><p id="modal-address" class="text-gray-700 text-sm leading-relaxed font-medium">åœ°å€è¼‰å…¥ä¸­...</p></div></div>
                    <div class="flex items-start"><span class="text-xl mr-3 mt-0.5 text-gray-400">ğŸ•’</span><div><p class="text-xs font-bold text-gray-400 uppercase tracking-wide">ç‡Ÿæ¥­æ™‚é–“</p><p id="modal-hours" class="text-gray-700 text-sm leading-relaxed font-medium">ç‡Ÿæ¥­æ™‚é–“è¼‰å…¥ä¸­...</p></div></div>
                    <div id="modal-ticket-row" class="flex items-start hidden"><span class="text-xl mr-3 mt-0.5 text-gray-400">ğŸ«</span><div><p class="text-xs font-bold text-gray-400 uppercase tracking-wide">è²»ç”¨ / ç¥¨åƒ¹</p><p id="modal-ticket" class="text-orange-600 text-sm leading-relaxed font-bold">ç„¡è³‡è¨Š</p></div></div>
                    <div id="modal-aircraft-row" class="flex items-start hidden"><span class="text-xl mr-3 mt-0.5 text-gray-400">âœˆï¸</span><div><p class="text-xs font-bold text-gray-400 uppercase tracking-wide">æ©Ÿå‹</p><p id="modal-aircraft" class="text-slate-600 text-sm leading-relaxed font-bold">è¼‰å…¥ä¸­...</p></div></div>
                </div>
                <div class="mt-6 pt-4 border-t border-gray-100">
                    <button id="modal-map-btn" class="w-full bg-sky-600 text-white py-3 rounded-xl font-bold hover:bg-sky-700 transition flex items-center justify-center shadow-lg shadow-sky-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" /></svg>
                        é–‹å•Ÿ Google Maps
                    </button>
                </div>
            </div>
        </div>

        <!-- Banner -->
        <header class="header-bg p-6 sm:p-10 text-white text-center rounded-b-xl relative shadow-md z-0">
            <h1 id="header-title" class="text-3xl sm:text-4xl font-extrabold opacity-95 mb-2">æ—…ç¨‹è¼‰å…¥ä¸­...</h1>
            <p id="header-subtitle" class="text-sm font-light tracking-widest">è¼‰å…¥ä¸­...</p>
        </header>

        <!-- å°è¦½åˆ— Card -->
        <div class="mx-4 -mt-6 relative z-10">
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                 <div id="main-tabs" class="flex overflow-x-auto whitespace-nowrap border-b border-gray-100"></div>
                 <div id="day-tabs" class="hidden overflow-x-auto whitespace-nowrap bg-slate-50/50"></div>
            </div>
        </div>

        <div id="dynamic-content" class="content-area px-4 pb-12 pt-6">
            <div class="text-center text-gray-500 py-16">è¼‰å…¥ä¸­...</div>
        </div>

        <footer class="text-center text-gray-400 text-xs py-6">
            <p>Designed for your trip.</p>
        </footer>
    </div>

    <!-- Logic -->
    <script>
        const FALLBACK_RATE = 0.20; 
        let currentExchangeRate = FALLBACK_RATE; 
        let activeMainTab = 'home'; 
        let activeDayId = 'day-1';

        // æ¨£å¼è¼”åŠ©å‡½å¼
        function getStyleByType(type) {
            const styles = {
                "flight": { // é£›è¡Œ (è™èˆª, è¯èˆª) -> äº¤é€šæ¨£å¼, é£›æ©Ÿåœ–ç¤º, ç°è‰²
                    isTraffic: true, 
                    iconName: "flight",
                    bgColor: "bg-white border-2 border-slate-300", 
                    iconColor: "text-slate-500" 
                },
                "transport": { // ä¸€èˆ¬äº¤é€š -> äº¤é€šæ¨£å¼, è»Šå­åœ–ç¤º, ç°è‰²
                    isTraffic: true,
                    iconName: "transport",
                    bgColor: "bg-white border-2 border-slate-300",
                    iconColor: "text-slate-500"
                },
                "airport": { // æ©Ÿå ´åœ°é» -> å¡ç‰‡æ¨£å¼, å¡”å°åœ–ç¤º, è—è‰²
                    isTraffic: false,
                    iconName: "airport",
                    bgColor: "bg-sky-500",
                    iconColor: "text-white"
                },
                "food": {
                    isTraffic: false,
                    iconName: "food",
                    bgColor: "bg-orange-400",
                    iconColor: "text-white"
                },
                "shopping": {
                    isTraffic: false,
                    iconName: "shopping",
                    bgColor: "bg-pink-400",
                    iconColor: "text-white"
                },
                "hotel": {
                    isTraffic: false,
                    iconName: "hotel",
                    bgColor: "bg-indigo-400",
                    iconColor: "text-white"
                },
                "sight": {
                    isTraffic: false,
                    iconName: "sight",
                    bgColor: "bg-emerald-400",
                    iconColor: "text-white"
                },
                "culture": {
                    isTraffic: false,
                    iconName: "sight",
                    bgColor: "bg-emerald-400",
                    iconColor: "text-white"
                }
            };
            return styles[type] || styles["sight"];
        }

        // SVG åœ–ç¤ºå®šç¾©
        function getIconSvg(name, colorClass) {
            const icons = {
                "transport": `<svg class="w-3.5 h-3.5 ${colorClass}" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path d="M19 14l-7 7m0 0l-7-7m7 7V3" /></svg>`, 
                "airport": `<svg class="w-4 h-4 ${colorClass}" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18.2 12.27 20 6H4l1.8 6.27a1 1 0 0 0 .95.73h10.5a1 1 0 0 0 .96-.73Z"/><path d="M8 13v9"/><path d="M16 22v-9"/><path d="m9 6 1 7"/><path d="m15 6-1 7"/><path d="M12 6V2"/><path d="M13 2h-2"/></svg>`, 
                "flight": `<svg class="w-3.5 h-3.5 ${colorClass}" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z"/></svg>`, 
                "food": `<svg class="w-4 h-4 ${colorClass}" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2" /><path d="M7 2v20" /><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7" /></svg>`,
                "hotel": `<svg class="w-4 h-4 ${colorClass}" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M2 4v16" /><path d="M2 8h18a2 2 0 0 1 2 2v10" /><path d="M2 17h20" /><path d="M6 8v9" /></svg>`,
                "shopping": `<svg class="w-4 h-4 ${colorClass}" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z" /><path d="M3 6h18" /><path d="M16 10a4 4 0 0 1-8 0" /></svg>`,
                "sight": `<svg class="w-4 h-4 ${colorClass}" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z" /><circle cx="12" cy="13" r="3" /></svg>`
            };
            return icons[name] || icons["sight"];
        }

        function toggleCheck(id) {
            const checkbox = document.getElementById(id);
            const text = document.getElementById(`text-${id}`);
            if (checkbox && text) {
                checkbox.checked = !checkbox.checked;
                if (checkbox.checked) {
                    text.classList.add('checked-text');
                } else {
                    text.classList.remove('checked-text');
                }
            }
        }

        window.openModal = function(arg1, address, hours, ticket, query, jpTitle, aircraft) {
            let data = {};
            if (typeof arg1 === 'string' && (arg1.startsWith('%7B') || arg1.startsWith('{'))) {
                try { data = JSON.parse(decodeURIComponent(arg1)); } catch (e) { data = { title: arg1 }; }
            } else {
                data = { title: arg1, address: address, hours: hours, ticket: ticket, query: query, jpName: jpTitle, aircraft: aircraft };
            }
            document.getElementById('modal-title').textContent = data.title || "";
            document.getElementById('modal-jp-name').textContent = data.jpName || ""; 
            document.getElementById('modal-address').textContent = data.address || "ç„¡è³‡è¨Š";
            document.getElementById('modal-hours').textContent = data.hours || "ä¾ç¾å ´ç‚ºæº–";
            const ticketRow = document.getElementById('modal-ticket-row');
            const ticketText = document.getElementById('modal-ticket');
            if (data.ticket && data.ticket !== 'undefined') {
                ticketText.textContent = data.ticket;
                ticketRow.classList.remove('hidden');
            } else {
                ticketRow.classList.add('hidden');
            }
            const aircraftRow = document.getElementById('modal-aircraft-row');
            const aircraftText = document.getElementById('modal-aircraft');
            if (data.aircraft) {
                aircraftText.textContent = data.aircraft;
                aircraftRow.classList.remove('hidden');
            } else {
                aircraftRow.classList.add('hidden');
            }
            document.getElementById('modal-map-btn').onclick = function() { 
                if(data.query) window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(data.query)}`, '_blank'); 
            };
            document.getElementById('location-modal').classList.remove('hidden');
        };

        window.closeModal = function() { document.getElementById('location-modal').classList.add('hidden'); };
        window.openInGoogleMaps = function(query) {
            if (query) window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(query)}`, '_blank'); 
        }

        const highlightText = (text, item, isClickable = false) => {
            if (!text) return "";
            return text.replace(/\*\*(.*?)\*\*/g, (match, p1) => {
                if (isClickable && item) {
                    let data = item;
                    if (item.highlights && item.highlights[p1]) {
                        data = item.highlights[p1];
                        if (!data.title) data.title = p1; 
                    }
                    const safeTitle = (data.title || p1 || item.name).replace(/'/g, "\\'").replace(/"/g, '&quot;');
                    const safeAddress = (data.address || item.address || "").replace(/'/g, "\\'").replace(/"/g, '&quot;');
                    const safeHours = (data.hours || item.hours || "").replace(/'/g, "\\'").replace(/"/g, '&quot;');
                    const safeQuery = (data.query || item.query || p1).replace(/'/g, "\\'").replace(/"/g, '&quot;');
                    const safeJpTitle = (data.jpName || item.jpName || "").replace(/'/g, "\\'").replace(/"/g, '&quot;');
                    const safeTicket = (data.ticket || item.ticket || "").replace(/'/g, "\\'").replace(/"/g, '&quot;');
                    const safeAircraft = (data.aircraft || item.aircraft || "").replace(/'/g, "\\'").replace(/"/g, '&quot;');
                    
                    const clickData = {
                        title: safeTitle,
                        address: safeAddress,
                        hours: safeHours,
                        query: safeQuery,
                        jpName: safeJpTitle,
                        ticket: safeTicket,
                        aircraft: safeAircraft
                    };
                    const dataStr = encodeURIComponent(JSON.stringify(clickData)).replace(/'/g, "%27");
                    return `<span class="highlight-text-clickable" onclick="openModal('${dataStr}')">${p1}</span>`;
                } else {
                    return `<span class="font-bold text-gray-700">${p1}</span>`;
                }
            });
        };

        const DEFAULT_ITINERARY_DATA = {
            "meta": {
                "title": "2026 å†¬å­£é™å®š | åŒ—æµ·é“å…­å¤©äº”å¤œä¹‹æ—…",
                "subtitle": "ç ´å†°èˆ¹ï¼é›ªä¸Šæ´»å‹•ï¼å°æ¨½æ•£ç­–",
                "dates": "2026-02-20 ~ 2026-02-25",
                "travelers": 2,
                "budget_per_person": 45000,
                "currency": "JPY"
            },
            "days": [
                {
                    "id": 1,
                    "date": "02/20 (äº”)",
                    "title": "æœ­å¹Œå•Ÿç¨‹",
                    "subtitle": "æ©Ÿå ´ç¾é£Ÿ â” å¸‚å€è£œè²¨ â” æµªæ¼«å¤œæ™¯",
                    "theme": "ç¾é£Ÿ/å¤œæ™¯",
                    "transport_mode": "Public",
                    "location": "æœ­å¹Œ, æ—¥æœ¬",
                    "sunrise": "06:28",
                    "sunset": "17:12",
                    "jmaUrl": "https://www.jma.go.jp/bosai/forecast/#area_type=class20s&area_code=0110000",
                    "summary": "æ¡ƒåœ’æ©Ÿå ´ -> æ–°åƒæ­²æ©Ÿå ´ -> é£¯åº—Check-in -> æœ­å¹Œå¤œæ™¯",
                    "breakfast": "æº«æš–çš„å®¶ / æ©Ÿä¸Šè‡ªç†",
                    "lunch": "ä¸€å¹»æ‹‰éºµ (æ–°åƒæ­²æ©Ÿå ´)",
                    "dinner": "æ ¹å®¤èŠ±ä¸¸è¿´è½‰å£½å¸",
                    "lodging": "Vessel Innæœ­å¹Œä¸­å³¶å…¬åœ’é£¯åº—",
                    "details": [
                        {
                            "time": "04:00",
                            "name": "æ¡ƒåœ’æ©Ÿå ´ç¬¬ä¸€èˆªå»ˆ",
                            "type": "airport", 
                            "desc": "è¾¦ç†å ±åˆ°æ‰‹çºŒèˆ‡è¡Œææ‰˜é‹ã€‚",
                            "query": "æ¡ƒåœ’æ©Ÿå ´ Terminal 1",
                            "jpName": "å°æ¹¾æ¡ƒåœ’å›½éš›ç©ºæ¸¯ ç¬¬1ã‚¿ãƒ¼ãƒŸãƒŠãƒ«",
                            "address": "æ¡ƒåœ’å¸‚å¤§åœ’å€èˆªç«™å—è·¯15è™Ÿ",
                            "hours": "24å°æ™‚é–‹æ”¾"
                        },
                        {
                            "time": "06:20",
                            "name": "è™èˆª IT 234",
                            "type": "flight",
                            "desc": "æ­ä¹˜ é£›å¾€åŒ—æµ·é“æ–°åƒæ­²æ©Ÿå ´ã€‚",
                            "query": "æ¡ƒåœ’åœ‹éš›æ©Ÿå ´ç¬¬ä¸€èˆªå»ˆ",
                            "jpName": "å°æ¹¾æ¡ƒåœ’å›½éš›ç©ºæ¸¯ ç¬¬1ã‚¿ãƒ¼ãƒŸãƒŠãƒ«",
                            "address": "æ¡ƒåœ’å¸‚å¤§åœ’å€èˆªç«™å—è·¯15è™Ÿ (ç¬¬ä¸€èˆªå»ˆ)",
                            "hours": "èˆªç­æ™‚é–“ä¾èˆªç©ºå…¬å¸å…¬å‘Š",
                            "flight": "é£›è¡Œæ™‚é–“ 3å°æ™‚35åˆ†",
                            "aircraft": "Airbus A320 / A320neo (å–®èµ°é“)"
                        },
                        {
                            "time": "10:55",
                            "name": "åŒ—æµ·é“æ–°åƒæ­²æ©Ÿå ´",
                            "type": "airport",
                            "desc": "æŠµé”ï¼Œè¾¦ç†å…¥å¢ƒæ‰‹çºŒã€‚",
                            "query": "æ–°åƒæ­²æ©Ÿå ´",
                            "jpName": "æ–°åƒæ­³ç©ºæ¸¯",
                            "address": "æ—¥æœ¬ã€ã€’066-0012 åŒ—æµ·é“åƒæ­³å¸‚ç¾ã€…",
                            "hours": "åœ‹å…§ç·š 6:20-23:00"
                        },
                        {
                            "time": "12:00",
                            "name": "ä¸€å¹»æ‹‰éºµ æ–°åƒæ­²æ©Ÿå ´åº—",
                            "type": "food",
                            "desc": "æ­¥è¡Œè‡³åœ‹å…§ç·š 3F **åŒ—æµ·é“æ‹‰éºµé“å ´**ï¼Œäº«ç”¨è¶…äººæ°£æ¿ƒéƒé®®è¦æ¹¯é ­æ‹‰éºµã€‚",
                            "query": "ä¸€å¹»æ‹‰éºµ æ–°åƒæ­²æ©Ÿå ´åº—",
                            "jpName": "ãˆã³ãã°ä¸€å¹» æ–°åƒæ­³ç©ºæ¸¯åº—",
                            "address": "æ–°åƒæ­²æ©Ÿå ´åœ‹å…§ç·šèˆªå»ˆ 3F",
                            "hours": "10:00-21:00",
                            "ticket": "æ‹›ç‰Œï¼šé®®è¦é¹½å‘³æ‹‰éºµ / éœ€æ’éšŠ" 
                        },
                        {
                            "time": "13:10",
                            "name": "äº¤é€šï¼šæ­¥è¡Œå‰å¾€è»Šç«™/å·´å£«ç«™",
                            "type": "transport",
                            "desc": "å¾åœ‹å…§ç·š 3F ç§»å‹•è‡³ B1F æˆ– 1Fã€‚",
                            "query": "New Chitose Airport",
                            "jpName": "ç©ºæ¸¯å†…ç§»å‹•",
                            "address": "åœ‹å…§ç·šèˆªå»ˆ",
                            "hours": "ç´„ 10-15 åˆ†é˜"
                        },
                        {
                            "time": "13:30",
                            "name": "äº¤é€šç§»å‹•ï¼šæ–°åƒæ­²æ©Ÿå ´ â” é£¯åº—",
                            "type": "transport",
                            "desc": "(äºŒé¸ä¸€)\n1. **JR å¿«é€Ÿ Airport**ï¼šæ­è‡³**æœ­å¹Œç«™**ï¼Œè½‰ä¹˜ **åœ°ä¸‹éµå—åŒ—ç·š** è‡³ **ä¸­å³¶å…¬åœ’ç«™** (2è™Ÿå‡ºå£)ã€‚\n2. **æ©Ÿå ´å·´å£«**ï¼šç›´é”ä¸­å³¶å…¬åœ’ (å…æ¬è¡Œæï¼Œä½†åœ¨è·¯é¢å¯èƒ½å—é›ªæ³å½±éŸ¿)ã€‚",
                            "query": "JR æ–°åƒæ­²æ©Ÿå ´ç«™",
                            "jpName": "æ–°åƒæ­³ç©ºæ¸¯é§… / ç©ºæ¸¯é€£çµ¡ãƒã‚¹",
                            "address": "JR: B1F | å·´å£«: 1F ä¹˜è»Šè™•",
                            "hours": "JR: æ¯12åˆ†ä¸€ç­ | å·´å£«: ç´„æ¯å°æ™‚ä¸€ç­",
                            "ticket": "JR: Â¥1,150 + åœ°éµ Â¥210 | å·´å£«: Â¥1,300",
                            "highlights": {
                                "JR å¿«é€Ÿ Airport": {
                                    "query": "JR æ–°åƒæ­²æ©Ÿå ´ç«™",
                                    "jpName": "JR æ–°åƒæ­³ç©ºæ¸¯é§…",
                                    "address": "æ–°åƒæ­²æ©Ÿå ´ B1F",
                                    "hours": "æ¯ 12-15 åˆ†é˜ä¸€ç­ (æœ€å¿« 37 åˆ†)",
                                    "ticket": "Â¥1,150 (éœ€è½‰ä¹˜åœ°éµ)"
                                },
                                "æœ­å¹Œç«™": {
                                    "query": "Sapporo Station",
                                    "jpName": "JR æœ­å¹Œé§…",
                                    "address": "åŒ—æµ·é“æœ­å¹Œå¸‚åŒ—åŒºåŒ—6æ¡è¥¿4ä¸ç›®",
                                    "hours": "05:00-24:00"
                                },
                                "åœ°ä¸‹éµå—åŒ—ç·š": {
                                    "query": "Sapporo Subway Namboku Line",
                                    "jpName": "æœ­å¹Œå¸‚å–¶åœ°ä¸‹é‰„å—åŒ—ç·š",
                                    "address": "æœ­å¹Œç«™ â” ä¸­å³¶å…¬åœ’ç«™",
                                    "hours": "ç´„ 6 åˆ†é˜ä¸€ç­",
                                    "ticket": "Â¥210"
                                },
                                "ä¸­å³¶å…¬åœ’ç«™": {
                                    "query": "Nakajima Koen Station",
                                    "jpName": "ä¸­å³¶å…¬åœ’é§… (N09)",
                                    "address": "æœ­å¹Œå¸‚ä¸­å¤®åŒºå—9æ¡è¥¿4ä¸ç›®",
                                    "hours": "06:00-24:00",
                                    "ticket": "2è™Ÿå‡ºå£é›¢é£¯åº—æœ€è¿‘"
                                },
                                "æ©Ÿå ´å·´å£«": {
                                    "query": "New Chitose Airport Bus Stop",
                                    "jpName": "ç©ºæ¸¯é€£çµ¡ãƒã‚¹ (ä¸­å³¶å…¬åœ’è¡Œ)",
                                    "address": "åœ‹å…§ç·š 14/22 è™Ÿä¹˜è»Šè™• (ç›´é”ä¸­å³¶å…¬åœ’)",
                                    "hours": "ç´„ 12:00 / 14:00 / 16:00 / 19:00 (ç­æ¬¡è¼ƒå°‘)",
                                    "ticket": "Â¥1,300 / è»Šç¨‹ç´„ 80 åˆ†é˜ (å…è½‰è»Š)"
                                }
                            }
                        },
                        {
                            "time": "15:00",
                            "name": "Lawson æœ­å¹Œä¸­å³¶å…¬åœ’åº—",
                            "type": "shopping",
                            "desc": "é£¯åº—éš”å£ï¼Œè³¼è²· **é˜²æ»‘é‹å¥—** è£åœ¨é‹å­ä¸Šï¼Œé¿å…é›ªåœ°æ»‘å€’ã€‚",
                            "query": "Lawson Sapporo Nakajima Park",
                            "jpName": "ãƒ­ãƒ¼ã‚½ãƒ³ æœ­å¹Œä¸­å³¶å…¬åœ’åº—",
                            "address": "å°±åœ¨é£¯åº—è½‰è§’ (èµ°è·¯ç´„ 1 åˆ†é˜)",
                            "hours": "24å°æ™‚",
                            "ticket": "Â¥1,500 / å¿…è²·é˜²æ»‘é‹å¥—"
                        },
                        {
                            "time": "15:10",
                            "name": "Vessel Inn æœ­å¹Œä¸­å³¶å…¬åœ’",
                            "type": "hotel",
                            "desc": "å‰å¾€é£¯åº—è¾¦ç† Check-inã€‚",
                            "query": "Vessel Inn æœ­å¹Œä¸­å³¶å…¬åœ’",
                            "jpName": "ãƒ™ãƒƒã‚»ãƒ«ã‚¤ãƒ³æœ­å¹Œä¸­å³¶å…¬åœ’",
                            "address": "åŒ—æµ·é“æœ­å¹Œå¸‚ä¸­å¤®åŒºå—ä¹æ¡è¥¿4-1-2",
                            "hours": "Check-in: 14:00"
                        },
                        {
                            "time": "15:25",
                            "name": "äº¤é€šï¼šæ­ä¹˜åœ°ä¸‹éµ",
                            "type": "transport",
                            "desc": "ä¸­å³¶å…¬åœ’ â” å¤§é€šç«™",
                            "query": "Nakajima Koen Station",
                            "jpName": "åœ°ä¸‹é‰„å—åŒ—ç·š",
                            "address": "ä¸­å³¶å…¬åœ’ç«™(N09) æ­å¾€éº»ç”Ÿæ–¹å‘ â” å¤§é€šç«™(N07)ä¸‹è»Š",
                            "hours": "è»Šç¨‹ç´„ 3-4 åˆ†é˜",
                            "ticket": "Â¥210 (å¯åˆ· IC å¡)"
                        },
                        {
                            "time": "15:30",
                            "name": "UNIQLO æœ­å¹Œ Parco åº—",
                            "type": "shopping",
                            "desc": "å‰å¾€ Parco 8F æ¡è³¼ä¿æš–è¡£ç‰©ã€‚",
                            "query": "UNIQLO Sapporo Parco",
                            "jpName": "ãƒ¦ãƒ‹ã‚¯ãƒ­ æœ­å¹Œãƒ‘ãƒ«ã‚³åº—",
                            "address": "æœ­å¹Œå¸‚ä¸­å¤®å€å—1æ¢è¥¿3-3 (Parco 8F)",
                            "hours": "10:00-20:00"
                        },
                        {
                            "time": "17:00",
                            "name": "æœ­å¹Œå¤§é€šå…¬åœ’",
                            "type": "sight",
                            "desc": "æ›ä¸Šæ–°è²·çš„ä¿æš–è¡£ç‰©ï¼Œå‰å¾€æ—é‚Šçš„å…¬åœ’æ•£æ­¥ï¼Œæ¬£è³é›ªæ™¯ã€‚",
                            "query": "æœ­å¹Œå¤§é€šå…¬åœ’",
                            "jpName": "å¤§é€šå…¬åœ’",
                            "address": "æœ­å¹Œå¸‚ä¸­å¤®åŒºå¤§é€šè¥¿1ï½12ä¸ç›®",
                            "hours": "å…¨å¤©é–‹æ”¾"
                        },
                        {
                            "time": "17:30",
                            "name": "æœ­å¹Œé›»è¦–å¡”",
                            "type": "sight",
                            "desc": "ç™»ä¸Šå±•æœ›å°ï¼Œä¿¯ç°æœ­å¹Œå¸‚å€å¤œæ™¯ã€‚",
                            "query": "æœ­å¹Œé›»è¦–å¡”",
                            "jpName": "ã•ã£ã½ã‚ãƒ†ãƒ¬ãƒ“å¡”",
                            "address": "æœ­å¹Œå¸‚ä¸­å¤®åŒºå¤§é€šè¥¿1ä¸ç›®",
                            "hours": "9:00 ï½ 22:00 ï¼ˆå±•æœ›æœ€çµ‚å…¥å ´ 21:50ï¼‰",
                            "ticket": "Â¥1,000"
                        },
                        {
                            "time": "18:30",
                            "name": "æœ­å¹Œåœ°ä¸‹è¡—",
                            "type": "shopping",
                            "desc": "è‡ªç”±é€›è¡—æ™‚é–“ï¼šå‰å¾€ Aurora Town/Pole Town æˆ– Parco ç™¾è²¨ã€‚",
                            "query": "æœ­å¹Œåœ°ä¸‹è¡—",
                            "jpName": "ã•ã£ã½ã‚åœ°ä¸‹è¡—",
                            "address": "æœ­å¹Œå¸‚ä¸­å¤®åŒºå¤§é€š",
                            "hours": "10:00-20:00"
                        },
                        {
                            "time": "19:30",
                            "name": "#C-pla ç‹¸å°è·¯4ä¸ç›®åº—",
                            "type": "shopping",
                            "desc": "å‰å¾€ç›¡æƒ…æ‰­è›‹ï¼(5ä¸ç›®åº—å·²æ­‡æ¥­ï¼Œæ”¹è‡³4ä¸ç›®ï¼Œç‹¸å°è·¯å¾ˆå¤šæ‰­è›‹åº—)",
                            "query": "#C-pla ç‹¸å°è·¯4ä¸ç›®åº—",
                            "jpName": "#C-pla ç‹¸å°è·¯4ä¸ç›®åº—",
                            "address": "åŒ—æµ·é“æœ­å¹Œå¸‚ä¸­å¤®åŒºå—2æ¡è¥¿4ä¸ç›®10 æ¸…æ°´ãƒ“ãƒ«1Fãƒ»2F",
                            "hours": "10:00-23:00"
                        },
                        {
                            "time": "20:15",
                            "name": "äº¤é€šï¼šå‰å¾€æœ­å¹Œè»Šç«™",
                            "type": "transport",
                            "desc": "å¾ç‹¸å°è·¯æ­¥è¡Œç¶“åœ°ä¸‹è¡—æˆ–æ­åœ°éµå‰å¾€ JR Tower Stellar Placeã€‚",
                            "query": "Sapporo Station",
                            "jpName": "æœ­å¹Œé§…",
                            "address": "å‰å¾€ JR Tower Stellar Place",
                            "hours": "ç´„ 15-20 åˆ†é˜"
                        },
                        {
                            "time": "20:30",
                            "name": "è¿´è½‰å£½å¸ æ ¹å®¤èŠ±ä¸¸",
                            "type": "food",
                            "desc": "äº«ç”¨æ™šé¤ã€‚\n1. **é¦–é¸ï¼šJR Tower Stellar Placeåº—** (6Fï¼Œé¢¨æ™¯å¥½ä½†æ’éšŠä¹…)\n2. **å‚™æ¡ˆï¼šmiredoåº—** (å¤§åŒç”Ÿå‘½å¤§æ¨“ B1ï¼Œç›¸å°å¥½æ’)",
                            "query": "Nemuro Hanamaru JR Tower Stellar Place",
                            "jpName": "å›è»¢å¯¿å¸ æ ¹å®¤èŠ±ã¾ã‚‹",
                            "address": "æœ­å¹Œè»Šç«™å‘¨é‚Š",
                            "hours": "11:00-22:00",
                            "ticket": "äººæ°£ååº— / å»ºè­°å…ˆæŠ½è™Ÿç¢¼ç‰Œ",
                            "highlights": {
                                "é¦–é¸ï¼šJR Tower Stellar Placeåº—": {
                                    "query": "Nemuro Hanamaru JR Tower Stellar Place",
                                    "jpName": "å›è»¢å¯¿å¸ æ ¹å®¤èŠ±ã¾ã‚‹ JRã‚¿ãƒ¯ãƒ¼ã‚¹ãƒ†ãƒ©ãƒ—ãƒ¬ã‚¤ã‚¹åº—",
                                    "address": "æœ­å¹Œå¸‚ä¸­å¤®åŒºåŒ—5æ¡è¥¿2ä¸ç›® 6F",
                                    "hours": "11:00-22:00"
                                },
                                "å‚™æ¡ˆï¼šmiredoåº—": {
                                    "title": "æ ¹å®¤èŠ±ä¸¸ miredoåº—",
                                    "query": "Nemuro Hanamaru miredo",
                                    "jpName": "å›è»¢å¯¿å¸ æ ¹å®¤èŠ±ã¾ã‚‹ å¤§åŒç”Ÿå‘½æœ­å¹Œãƒ“ãƒ«miredoåº—",
                                    "address": "æœ­å¹Œå¸‚ä¸­å¤®åŒºåŒ—3æ¡è¥¿3ä¸ç›®1 B1F",
                                    "hours": "11:00-22:00",
                                    "ticket": "å¾æœ­å¹Œç«™æ­¥è¡Œç´„ 5 åˆ†é˜"
                                }
                            }
                        },
                        {
                            "time": "22:00",
                            "name": "äº¤é€šï¼šæ­ä¹˜åœ°ä¸‹éµå›é£¯åº—",
                            "type": "transport",
                            "desc": "æœ­å¹Œç«™ â” ä¸­å³¶å…¬åœ’ç«™",
                            "query": "Sapporo Station Subway",
                            "jpName": "åœ°ä¸‹é‰„å—åŒ—ç·š",
                            "address": "æœ­å¹Œç«™(N06) â” ä¸­å³¶å…¬åœ’ç«™(N09)",
                            "hours": "è»Šç¨‹ç´„ 5 åˆ†é˜",
                            "ticket": "Â¥210 (å¯åˆ· IC å¡)"
                        },
                        {
                            "time": "22:15",
                            "name": "é£¯åº—ä¼‘æ¯",
                            "type": "hotel",
                            "desc": "æŠµé”é£¯åº—ï¼Œé€”ä¸­ç¶“é **Lawson** è£œçµ¦éš”å¤©æ—©é¤ã€‚",
                            "query": "Vessel Inn æœ­å¹Œä¸­å³¶å…¬åœ’",
                            "jpName": "ãƒ™ãƒƒã‚»ãƒ«ã‚¤ãƒ³æœ­å¹Œä¸­å³¶å…¬åœ’",
                            "address": "å—9è¥¿4",
                            "hours": "24å°æ™‚"
                        }
                    ]
                },
                {
                    "id": 2,
                    "date": "02/21 (å…­)",
                    "title": "æ—­å·ä¸€æ—¥éŠ",
                    "subtitle": "ä¼éµæ•£æ­¥ â” é›ªä¸Šæ¨‚åœ’ â” æº«æ³‰é£¯åº—",
                    "summary": "æ—­å±±å‹•ç‰©åœ’ -> é›ªä¸Šæ¨‚åœ’ -> å±¤é›²å³½æº«æ³‰",
                    "sunrise": "06:26",
                    "sunset": "17:14",
                    "breakfast": "æ—©é¤è‡ªç†",
                    "lunch": "ç„—çƒ¤èƒèŸ¹æµ·é®®é™¶æ¿ç‡’å¾¡è†³",
                    "dinner": "æº«æ³‰é£¯åº—è±ªè¯æ™šé¤",
                    "lodging": "**å±¤é›²å³½å‘¨é‚Šæº«æ³‰é£¯åº—**",
                    "details": [
                        { "time": "08:00", "name": "å‰å¾€æ—­å±±å‹•ç‰©åœ’", "type": "sight", "desc": "å‰å¾€ **æ—­å±±å‹•ç‰©åœ’**", "query": "æ—­å±±å‹•ç‰©åœ’", "ticket": "Â¥1,000 / å¤§äºº" },
                        { "time": "14:00", "name": "å‰å¾€åŒ—æµ·é“é›ªä¸Šæ¨‚åœ’", "type": "sight", "desc": "å‰å¾€ **åŒ—æµ·é“é›ªä¸Šæ¨‚åœ’**", "query": "ã´ã£ã·ã‚¹ã‚­ãƒ¼å ´" },
                        { "time": "18:00", "name": "å…¥ä½å±¤é›²å³½æº«æ³‰é£¯åº—", "type": "hotel", "desc": "å…¥ä½ **å±¤é›²å³½æº«æ³‰é£¯åº—**", "query": "å±¤é›²å³½æº«æ³‰" }
                    ]
                },
                {
                    "id": 3,
                    "date": "02/22 (æ—¥)",
                    "title": "ç´‹åˆ¥ç ´å†°èˆ¹",
                    "subtitle": "æµå†°éœ‡æ’¼ â” éŠ€æ²³ç€‘å¸ƒ â” é…’é€ è¦‹å­¸",
                    "summary": "éŠ€æ²³ç€‘å¸ƒ -> ç´‹åˆ¥ç ´å†°èˆ¹ -> ç”·å±±é…’é€ ",
                    "sunrise": "06:25",
                    "sunset": "17:15",
                    "breakfast": "é£¯åº—å…§æ—©é¤",
                    "lunch": "è±ªè¯èŸ¹è…³å¹²è²ç«¯çˆç‡’",
                    "dinner": "æœ­å¹Œå¸‚å€è‡ªç†",
                    "lodging": "æœ­å¹Œè’™ç‰¹åˆ©åŸƒå¾·çˆ¾éœå¤«é…’åº—",
                    "details": [
                        { "time": "08:30", "name": "åƒè§€éŠ€æ²³æµæ˜Ÿç€‘å¸ƒ", "type": "sight", "desc": "åƒè§€ **éŠ€æ²³æµæ˜Ÿç€‘å¸ƒ**", "query": "éŠ€æ²³æµæ˜Ÿç€‘å¸ƒ" },
                        { "time": "10:30", "name": "æ­ä¹˜ç´‹åˆ¥ç ´å†°èˆ¹", "type": "sight", "desc": "æ­ä¹˜ **ç´‹åˆ¥ç ´å†°èˆ¹** (GARINKOè™Ÿ)", "query": "ç´‹åˆ¥ GARINKO è™Ÿ", "ticket": "Â¥5,000 / éœ€é ç´„" },
                        { "time": "14:30", "name": "åƒè§€æ—­å·ç”·å±±é…’é€ ", "type": "sight", "desc": "åƒè§€ **æ—­å·ç”·å±±é…’é€ **", "query": "æ—­å·ç”·å±±é…’é€ " }
                    ]
                },
                {
                    "id": 4,
                    "date": "02/23 (ä¸€)",
                    "title": "å°æ¨½æµªæ¼«è¡Œ",
                    "subtitle": "é‹æ²³æ•£ç­– â” éŸ³æ¨‚ç›’å ‚ â” å¤©ç‹—å±±å¤œæ™¯",
                    "summary": "å°æ¨½é‹æ²³ -> åŒ—ä¸€ç¡å­é¤¨ -> å¤©ç‹—å±±å¤œæ™¯",
                    "sunrise": "06:23",
                    "sunset": "17:16",
                    "breakfast": "æ—©é¤è‡ªç†",
                    "lunch": "å°æ¨½å£½å¸",
                    "dinner": "æ‹‰éºµå…±å’Œåœ‹",
                    "lodging": "æœ­å¹Œè’™ç‰¹åˆ©åŸƒå¾·çˆ¾éœå¤«é…’åº—",
                    "details": [
                        { "time": "10:00", "name": "å‰å¾€å°æ¨½é‹æ²³", "type": "sight", "desc": "å‰å¾€ **å°æ¨½é‹æ²³**", "query": "å°æ¨½é‹æ²³" },
                        { "time": "14:00", "name": "é€›åŒ—ä¸€ç¡å­é¤¨èˆ‡éŸ³æ¨‚ç›’å ‚", "type": "shopping", "desc": "é€› **åŒ—ä¸€ç¡å­é¤¨** èˆ‡ **éŸ³æ¨‚ç›’å ‚**", "query": "å°æ¨½éŸ³æ¨‚ç›’åšç‰©é¤¨" },
                        { "time": "16:30", "name": "æ­çºœè»Šä¸Šå¤©ç‹—å±±", "type": "sight", "desc": "æ­çºœè»Šä¸Š **å¤©ç‹—å±±** çœ‹å¤œæ™¯", "query": "å¤©ç‹—å±±çºœè»Š", "ticket": "Â¥1,600 / ä¾†å›" }
                    ]
                },
                {
                    "id": 5,
                    "date": "02/24 (äºŒ)",
                    "title": "æœ­å¹Œæ·±åº¦éŠ",
                    "subtitle": "åŒ—æµ·é“ç¥å®® â” ç™½è‰²æˆ€äºº â” ä¸‰å¤§èŸ¹",
                    "summary": "åŒ—æµ·é“ç¥å®® -> ç™½è‰²æˆ€äººå…¬åœ’ -> ä¸‰å¤§èŸ¹åƒåˆ°é£½",
                    "sunrise": "06:21",
                    "sunset": "17:18",
                    "breakfast": "æ—©é¤è‡ªç†",
                    "lunch": "Suage+ æ¹¯å’–å“©",
                    "dinner": "ä¸‰å¤§èŸ¹åƒåˆ°é£½",
                    "lodging": "æœ­å¹Œè’™ç‰¹åˆ©åŸƒå¾·çˆ¾éœå¤«é…’åº—",
                    "details": [
                        { "time": "09:00", "name": "åƒæ‹œåŒ—æµ·é“ç¥å®®", "type": "culture", "desc": "åƒæ‹œ **åŒ—æµ·é“ç¥å®®**", "query": "åŒ—æµ·é“ç¥å®®" },
                        { "time": "10:30", "name": "åƒè§€ç™½è‰²æˆ€äººå…¬åœ’", "type": "sight", "desc": "åƒè§€ **ç™½è‰²æˆ€äººå…¬åœ’**", "query": "ç™½è‰²æˆ€äººå…¬åœ’", "ticket": "Â¥800 / å¤§äºº" },
                        { "time": "19:00", "name": "å¤§åƒä¸‰å¤§èŸ¹åƒåˆ°é£½", "type": "food", "desc": "å¤§åƒ **ä¸‰å¤§èŸ¹åƒåˆ°é£½**", "query": "æœ­å¹Œä¸‰å¤§èŸ¹åƒåˆ°é£½" }
                    ]
                },
                {
                    "id": 6,
                    "date": "02/25 (ä¸‰)",
                    "title": "æ»¿è¼‰è€Œæ­¸",
                    "subtitle": "Outlet è¡€æ‹š â” æ©Ÿå ´æœ€å¾Œè¡åˆº â” æº«æš–çš„å®¶",
                    "summary": "ä¸‰äº• OUTLET -> æ–°åƒæ­²æ©Ÿå ´ -> è¿”å°",
                    "sunrise": "06:20",
                    "sunset": "17:19",
                    "breakfast": "é£¯åº—å…§æ—©é¤",
                    "lunch": "Outlet ç¾é£Ÿè¡—",
                    "dinner": "æ©Ÿä¸Šç°¡é¤",
                    "lodging": "æº«æš–çš„å®¶",
                    "details": [
                        { "time": "10:00", "name": "å‰å¾€ä¸‰äº• OUTLET", "type": "shopping", "desc": "å‰å¾€ **ä¸‰äº• OUTLET è³¼ç‰©ä¸­å¿ƒ**", "query": "æœ­å¹Œä¸‰äº•OUTLET" },
                        { "time": "13:30", "name": "æŠµé”æ–°åƒæ­²æ©Ÿå ´", "type": "airport", "desc": "æŠµé” **æ–°åƒæ­²æ©Ÿå ´** å ±åˆ°", "query": "æ–°åƒæ­²æ©Ÿå ´" },
                        { "time": "14:40", "name": "æ­ä¹˜è¯èˆª CI 131", "type": "flight", "desc": "æ­ä¹˜ **è¯èˆª CI 131** è¿”å°", "query": "æ–°åƒæ­²æ©Ÿå ´" }
                    ]
                }
            ]
        };
        
        let appItineraryData = DEFAULT_ITINERARY_DATA; 

        function renderMainTabs() {
            const container = document.getElementById('main-tabs');
            container.innerHTML = '';
            container.appendChild(createMainTab('ä¸»é ', 'home', `<svg class="w-5 h-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l-2-2m2 2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 01-1 1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>`));
            container.appendChild(createMainTab('è©³ç´°è¡Œç¨‹', 'itinerary-group', `<svg class="w-5 h-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h.01M7 12h.01M6 16h.01M9 16h.01M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>`));
            container.appendChild(createMainTab('è¡Œå‰æº–å‚™', 'preparation', `<svg class="w-5 h-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/></svg>`));
        }

        function createMainTab(text, viewId, iconHtml) {
            const button = document.createElement('button');
            button.className = 'tab-item main-tab text-gray-500';
            button.innerHTML = iconHtml + text;
            button.onclick = () => switchMainView(viewId);
            button.setAttribute('data-view', viewId);
            return button;
        }

        function renderDayTabs() {
            const container = document.getElementById('day-tabs');
            container.innerHTML = '';
            appItineraryData.days.forEach(day => {
                const button = document.createElement('button');
                button.className = 'tab-item day-tab text-gray-500'; 
                button.textContent = `Day ${day.id}`;
                button.setAttribute('data-day-id', `day-${day.id}`);
                button.onclick = () => switchDayView(`day-${day.id}`);
                container.appendChild(button);
            });
        }

        function switchMainView(viewId) {
            activeMainTab = viewId;
            document.querySelectorAll('.main-tab').forEach(tab => {
                tab.classList.remove('active', 'border-b-2', 'border-sky-500', 'text-sky-600');
                if (tab.getAttribute('data-view') === viewId) tab.classList.add('active', 'border-b-2', 'border-sky-500', 'text-sky-600');
            });
            const contentContainer = document.getElementById('dynamic-content');
            const dayTabsContainer = document.getElementById('day-tabs');
            const baseClasses = 'content-area bg-gray-50 px-4 sm:px-6';

            if (viewId === 'home') {
                contentContainer.className = baseClasses + ' pt-2 pb-8 sm:pb-12';
                dayTabsContainer.classList.add('hidden'); dayTabsContainer.classList.remove('flex');
                contentContainer.innerHTML = renderHomeContent();
            } else if (viewId === 'itinerary-group') {
                contentContainer.className = baseClasses + ' pt-0 pb-8 sm:pb-12';
                dayTabsContainer.classList.remove('hidden'); dayTabsContainer.classList.add('flex');
                switchDayView(activeDayId);
            } else if (viewId === 'preparation') {
                contentContainer.className = baseClasses + ' pt-2 pb-8 sm:pb-12';
                dayTabsContainer.classList.add('hidden'); dayTabsContainer.classList.remove('flex');
                contentContainer.innerHTML = renderPreparationContent();
            }
        }

        function switchDayView(dayId) {
            activeDayId = dayId;
            document.querySelectorAll('.day-tab').forEach(tab => {
                tab.classList.remove('active', 'border-b-2', 'border-sky-500', 'text-sky-600');
                if (tab.getAttribute('data-day-id') === dayId) tab.classList.add('active', 'border-b-2', 'border-sky-500', 'text-sky-600');
            });
            const dayNumber = parseInt(dayId.split('-')[1]);
            const dayData = appItineraryData.days.find(d => d.id === dayNumber);
            if (dayData) document.getElementById('dynamic-content').innerHTML = renderDayContent(dayData);
        }
        
        function renderExchangeRateBlock() {
            return `<div id="exchange-rate-block" class="max-w-xs mx-auto p-2 my-2 bg-transparent">
                <p class="text-sm font-semibold text-gray-600 mb-2 text-center">ğŸ’µ JPY â‡Œ TWD å¿«é€Ÿè©¦ç®—</p>
                <div class="flex space-x-2">
                    <div class="flex-1">
                        <input type="number" id="jpy-input" 
                            oninput="if(this.value.length > 6) this.value = this.value.slice(0, 6); convertCurrency()" 
                            placeholder="æ—¥å¹£" 
                            class="w-full py-2 px-3 border border-gray-300 rounded-lg text-sm shadow-sm focus:ring-sky-500">
                    </div>
                    <div id="twd-output" class="flex-1 flex items-center justify-end py-2 px-3 border border-gray-300 rounded-lg bg-gray-100 text-sm font-bold text-gray-700 text-right">0 TWD</div>
                </div>
                <div class="text-right text-xs text-gray-400 mt-1">åƒè€ƒåŒ¯ç‡: 0.20</div>
            </div>`;
        }
        
        function renderHomeContent() {
            const outboundFlight = { title: "è™èˆª IT 234", aircraft: 'Airbus A320 / A320neo (å–®èµ°é“)', query: "æ¡ƒåœ’åœ‹éš›æ©Ÿå ´ç¬¬ä¸€èˆªå»ˆ", jpName: "å°æ¹¾æ¡ƒåœ’å›½éš›ç©ºæ¸¯ ç¬¬1ã‚¿ãƒ¼ãƒŸãƒŠãƒ«", address: "æ¡ƒåœ’å¸‚å¤§åœ’å€èˆªç«™å—è·¯15è™Ÿ (ç¬¬ä¸€èˆªå»ˆ)", hours: "èˆªç­æ™‚é–“ä¾èˆªç©ºå…¬å¸å…¬å‘Š" };
            const inboundFlight = { title: "è¯èˆª CI 131", aircraft: 'Boeing 777-300ER (å»£é«”å®¢æ©Ÿ)', query: "æ–°åƒæ­²æ©Ÿå ´", jpName: "æ–°åƒæ­³ç©ºæ¸¯ å›½éš›ç·šã‚¿ãƒ¼ãƒŸãƒŠãƒ«", address: "åœ‹éš›ç·šèˆªå»ˆ (æŠµé”æ¡ƒåœ’ç¬¬ä¸€èˆªå»ˆ)", hours: "èˆªç­æ™‚é–“" };

            return `
                <div class="day-content p-6 sm:p-8 bg-white rounded-xl shadow-lg border border-gray-100 space-y-6">
                    <div>
                        <h3 class="text-2xl font-bold accent-color mb-3 border-b pb-2">âœˆï¸ èˆªç­è³‡è¨Š</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm font-medium p-2">
                             <div class="bg-blue-50 p-4 rounded-lg border border-blue-100 shadow-sm cursor-pointer hover:bg-blue-100 transition" onclick="openModal('${encodeURIComponent(JSON.stringify(outboundFlight)).replace(/'/g, "%27")}')">
                                <div class="font-bold text-lg text-[#2E4057] mb-3 flex items-center"><span class="mr-2">ğŸ›«</span> å»ç¨‹ï¼šå°åŒ— â” æœ­å¹Œ</div>
                                <div class="text-gray-700 space-y-2">
                                    <p class="flex justify-between border-b border-blue-100 pb-1"><span class="font-semibold text-gray-500">èˆªç­</span><span class="font-bold text-gray-800">è™èˆª IT 234</span></p>
                                    <p class="flex justify-between border-b border-blue-100 pb-1"><span class="font-semibold text-gray-500">æ™‚é–“</span><span>06:20 - 10:55 (3h 35m)</span></p>
                                    <p class="flex justify-between border-b border-blue-100 pb-1"><span class="font-semibold text-gray-500">èˆªå»ˆ</span><span class="font-bold text-red-600">æ¡ƒåœ’æ©Ÿå ´ç¬¬ä¸€èˆªå»ˆ (T1)</span></p>
                                    <p class="flex justify-between items-start"><span class="font-semibold text-gray-500 whitespace-nowrap mr-2">æ©Ÿå‹</span><span class="text-right text-slate-600">Airbus A320<br><span class="text-xs text-gray-400">(å–®èµ°é“)</span></span></p>
                                </div>
                            </div>
                            <div class="bg-orange-50 p-4 rounded-lg border border-orange-100 shadow-sm cursor-pointer hover:bg-orange-100 transition" onclick="openModal('${encodeURIComponent(JSON.stringify(inboundFlight)).replace(/'/g, "%27")}')">
                                <div class="font-bold text-lg text-[#2E4057] mb-3 flex items-center"><span class="mr-2">ğŸ›¬</span> å›ç¨‹ï¼šæœ­å¹Œ â” å°åŒ—</div>
                                <div class="text-gray-700 space-y-2">
                                    <p class="flex justify-between border-b border-orange-100 pb-1"><span class="font-semibold text-gray-500">èˆªç­</span><span class="font-bold text-gray-800">è¯èˆª CI 131</span></p>
                                    <p class="flex justify-between border-b border-orange-100 pb-1"><span class="font-semibold text-gray-500">æ™‚é–“</span><span>14:40 - 18:15 (4h 10m)</span></p>
                                    <p class="flex justify-between border-b border-orange-100 pb-1"><span class="font-semibold text-gray-500">èˆªå»ˆ</span><span class="font-bold text-red-600">æ–°åƒæ­²æ©Ÿå ´ç¬¬ä¸€èˆªå»ˆ (T1)</span></p>
                                    <p class="flex justify-between items-start"><span class="font-semibold text-gray-500 whitespace-nowrap mr-2">æ©Ÿå‹</span><span class="text-right text-slate-600">Boeing 777-300ER<br><span class="text-xs text-gray-400">(å»£é«”å®¢æ©Ÿ)</span></span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    ${renderExchangeRateBlock()} 
                    <div>
                        <h3 class="text-2xl font-bold accent-color mb-3 border-b pb-2">ğŸ¯ è¡Œç¨‹äº®é»</h3>
                        <ul class="space-y-3 pl-4 list-disc text-gray-700">
                            <li><strong class="text-sky-700">é›ªåœ°å¥‡è§€ï¼š</strong>æ­ä¹˜ç´‹åˆ¥**ç ´å†°èˆ¹**ï¼Œè¿‘è·é›¢æ„Ÿå—é„‚éœæ¬¡å…‹æµ·çš„æµå†°éœ‡æ’¼ã€‚</li>
                            <li><strong class="text-sky-700">å‹•ç‰©æ˜æ˜Ÿï¼š</strong>å‰å¾€**æ—­å±±å‹•ç‰©åœ’**ï¼Œè§€è³å†¬å­£é™å®šçš„ä¼éµé›ªåœ°æ•£æ­¥ã€‚</li>
                            <li><strong class="text-sky-700">æº«æ³‰ç™‚ç™’ï¼š</strong>å…¥ä½**å±¤é›²å³½æº«æ³‰é£¯åº—**ï¼Œäº«å—æ—¥å¼è±ªè¯æœƒå¸­æ–™ç†èˆ‡å¤©ç„¶æº«æ³‰ã€‚</li>
                            <li><strong class="text-sky-700">ç¾é£Ÿå¤©å ‚ï¼š</strong>é«”é©—**ä¸‰å¤§èŸ¹åƒåˆ°é£½**ã€æ¹¯å’–å“©ã€ä¸€å¹»æ‹‰éºµç­‰åŒ—æµ·é“å¿…åƒç¾é£Ÿã€‚</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        function renderPreparationContent() {
            let html = `
                <div class="day-content p-6 sm:p-8 bg-white rounded-xl shadow-lg border border-gray-100">
                    <h3 class="text-2xl font-black accent-color mb-3 border-b-2 pb-1">ğŸ’ è¡Œå‰æº–å‚™æ¸…å–®</h3>
                    <p class="text-gray-600 mb-6 text-lg">é‡å° 2 æœˆåŒ—æµ·é“é›ªå­£å„ªåŒ–ï¼Œè«‹å‹™å¿…ç¢ºèªä»¥ä¸‹ç‰©å“æ˜¯å¦å‚™é½Šã€‚</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            `;
            let catIndex = 0;
            for (const category in PREPARATION_LIST) {
                html += `
                    <div class="bg-gray-50 p-5 rounded-xl border border-gray-200">
                        <h4 class="font-bold text-xl text-sky-800 mb-3 pb-2 border-b border-gray-300">${category}</h4>
                        <ul class="space-y-2">
                `;
                PREPARATION_LIST[category].forEach((item, index) => {
                    const uniqueId = `prep-item-${catIndex}-${index}`;
                    html += `
                        <li class="checklist-item flex items-start" onclick="toggleCheck('${uniqueId}')">
                            <input type="checkbox" id="${uniqueId}" class="checklist-checkbox mt-1 mr-3 flex-shrink-0 cursor-pointer pointer-events-none">
                            <span id="text-${uniqueId}" class="text-gray-700 font-medium leading-relaxed">${item}</span>
                        </li>
                    `;
                });
                html += `</ul></div>`;
                catIndex++;
            }
            html += `</div></div>`;
            return html;
        }

        function renderDayContent(day) {
            const detailsHtml = day.details.map((item, index) => {
                let title = item.name;
                let desc = item.desc;
                const type = item.type; 

                // æ ¹æ“š type ç²å–æ¨£å¼é…ç½®
                const styleConfig = getStyleByType(type);
                const isTraffic = styleConfig.isTraffic;
                const iconSvg = getIconSvg(styleConfig.iconName, styleConfig.iconColor);
                const iconBg = styleConfig.bgColor;
                
                // Timeline Line Style (è™›ç·š vs å¯¦ç·š)
                const lineClass = isTraffic ? "timeline-line-dashed" : "timeline-line-solid";

                let itemData = { ...item };
                // itemData.title = title; // Already set as name in JSON
                // highlight logic if needed, already in JSON highlights structure
                
                const dataStr = encodeURIComponent(JSON.stringify(itemData)).replace(/'/g, "%27");
                const lastItemClass = index === day.details.length - 1 ? 'last-item' : '';
                const firstItemClass = index === 0 ? 'first-item' : '';

                // Extract Price
                let priceDisplay = "";
                let infoText = "";
                if (itemData.ticket) {
                    if (itemData.ticket.includes("Â¥")) {
                         const parts = itemData.ticket.split(/[\/|]/);
                         priceDisplay = parts[0].trim();
                         if (parts.length > 1) infoText = parts.slice(1).join(" ").trim();
                    } else {
                        infoText = itemData.ticket;
                    }
                }
                
                if (itemData.flight) {
                    infoText = infoText ? `${infoText} â€¢ ${itemData.flight}` : itemData.flight;
                }

                // è™•ç†å¤šè¡Œæè¿°
                const descHtml = desc.split('\n').map((line, i) => {
                    return i === 0 ? highlightText(line, item, true) : `<span class="block mt-1 text-slate-500 pl-4 border-l-2 border-slate-200 text-xs">${highlightText(line, item, true)}</span>`;
                }).join('');

                if (isTraffic) {
                    // [äº¤é€š/é£›è¡Œ æ¨£å¼] - è™›ç·šéå ´ï¼Œç°¡å–®æ–‡å­—ï¼Œé»æ¨™é¡Œå¯çœ‹è©³æƒ…
                    return `
                    <div class="flex gap-3 relative pb-6 ${lastItemClass} ${firstItemClass}">
                        <div class="timeline-col"> 
                             <div class="${lineClass}"></div>
                             <div class="w-7 h-7 rounded-full ${iconBg} flex items-center justify-center shadow-sm z-10 relative mt-1">
                                ${iconSvg}
                             </div>
                        </div>
                        <div class="flex-grow py-1">
                            <div class="flex flex-col sm:flex-row sm:items-center gap-2 mb-1">
                                <span class="text-slate-500 font-bold font-['Noto_Sans_JP'] text-sm tracking-wide bg-slate-100 px-2 py-0.5 rounded w-fit">${item.time}</span>
                                <h4 class="text-base font-bold text-slate-600 leading-snug cursor-pointer hover:text-sky-600 hover:underline" onclick="openModal('${dataStr}')">${title}</h4>
                                ${priceDisplay ? `<span class="bg-gray-100 text-gray-500 text-xs font-bold px-1.5 py-0.5 rounded border border-gray-200">${priceDisplay}</span>` : ''}
                            </div>
                            <div class="text-xs text-slate-500 leading-relaxed pl-1 border-l-2 border-slate-200 ml-1">
                                ${descHtml}
                            </div>
                            ${infoText ? `<p class="text-[10px] text-yellow-600 mt-1 pl-2 font-medium">ğŸ’¡ ${infoText}</p>` : ''}
                        </div>
                    </div>
                    `;
                } else {
                    // [ä¸€èˆ¬æ¨£å¼ (å«æ©Ÿå ´åœ°é»)] - ç™½è‰²å¡ç‰‡ï¼Œå¯¦ç·š
                    return `
                    <div class="flex gap-3 relative pb-8 ${lastItemClass} ${firstItemClass}">
                        <div class="timeline-col"> 
                             <div class="timeline-line-solid"></div>
                             <div class="w-8 h-8 rounded-full ${iconBg} flex items-center justify-center shadow-md z-10 relative mt-1">
                                ${iconSvg}
                             </div>
                        </div>
                        <div class="flex-grow bg-white rounded-xl p-4 shadow-sm border border-gray-100 hover:shadow-md transition-all relative">
                            <div class="flex justify-between items-start mb-2">
                                <span class="text-slate-500 font-bold font-['Noto_Sans_JP'] text-sm tracking-wide bg-slate-100 px-2 py-0.5 rounded">${item.time}</span>
                                ${priceDisplay ? `<span class="bg-gray-100 text-gray-600 text-xs font-bold px-2 py-1 rounded border border-gray-200">${priceDisplay}</span>` : '' }
                            </div>
                            <h4 class="text-lg font-bold text-sky-600 mb-1 leading-snug cursor-pointer hover:underline" onclick="openModal('${dataStr}')">${title}</h4>
                            <p class="text-sm text-gray-600 mb-3 leading-relaxed">${highlightText(desc, item, true).replace(/\n/g, '<br>')}</p>
                            ${infoText ? `<div class="bg-yellow-50 border border-yellow-100 text-yellow-800 text-xs p-2.5 rounded-lg mb-3 flex items-start"><span class="mr-1.5 text-sm">ğŸ’¡</span><span class="mt-0.5 leading-snug">${infoText}</span></div>` : ''}
                            <div class="text-sky-500 text-xs font-bold flex items-center hover:text-sky-600 mt-auto pt-2 border-t border-gray-50 cursor-pointer w-fit" onclick="event.stopPropagation(); openInGoogleMaps('${itemData.query}')">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 mr-1" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" /></svg>
                                åœ°åœ–å°èˆª
                            </div>
                        </div>
                    </div>
                    `;
                }
            }).join('');

            return `
                <div class="w-full px-1"> <!-- [èª¿æ•´] ç§»é™¤ max-w-3xl å’Œ mx-autoï¼Œæ”¹ç‚º w-fullï¼Œè®“å€å¡Šè®Šå¤§ -->
                    <div class="mb-6 pl-2">
                        <h2 class="text-2xl font-black text-slate-800 mb-2">${day.title}</h2>
                        <div class="flex flex-col sm:flex-row sm:items-center gap-3">
                            <p class="text-sm text-slate-500 font-medium">${day.subtitle}</p>
                             ${day.sunrise ? `
                                <div class="inline-flex items-center gap-3 text-xs font-semibold text-slate-500 bg-white px-3 py-1.5 rounded-full shadow-sm border border-slate-100 w-fit">
                                    <span class="flex items-center"><span class="text-orange-500 mr-1">ğŸŒ…</span>${day.sunrise}</span>
                                    <div class="h-3 w-[1px] bg-slate-300"></div>
                                    <span class="flex items-center"><span class="text-indigo-500 mr-1">ğŸŒ‡</span>${day.sunset}</span>
                                </div>
                            ` : ''}
                        </div>
                         ${day.jmaUrl ? `
                            <a href="${day.jmaUrl}" target="_blank" class="mt-3 inline-flex items-center text-xs font-bold text-sky-600 bg-sky-50 hover:bg-sky-100 px-3 py-1.5 rounded-full transition-colors border border-sky-100 w-fit">
                                ğŸŒ¤ï¸ å¤©æ°£é å ± (æ—¥æœ¬æ°£è±¡å»³)
                            </a>
                        ` : ''}
                    </div>
                    <div class="relative pt-2 pl-2">
                        ${detailsHtml}
                    </div>
                    <div class="mt-8 bg-slate-100 rounded-xl p-5 border border-slate-200">
                        <h4 class="text-sm font-bold text-slate-400 uppercase tracking-wider mb-3">Day Summary</h4>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-y-2 gap-x-4 text-sm">
                            <div class="flex"><span class="w-12 text-slate-500 font-medium">æ—©é¤</span> <span class="text-slate-800 font-medium">${day.breakfast}</span></div>
                            <div class="flex"><span class="w-12 text-slate-500 font-medium">åˆé¤</span> <span class="text-slate-800 font-medium">${day.lunch}</span></div>
                            <div class="flex"><span class="w-12 text-slate-500 font-medium">æ™šé¤</span> <span class="text-slate-800 font-medium">${day.dinner}</span></div>
                            <div class="flex items-start"><span class="w-12 text-slate-500 font-medium flex-shrink-0">ä½å®¿</span> <span class="text-slate-800 font-bold text-sky-700">${day.lodging.replace(/\*\*/g, '')}</span></div>
                        </div>
                    </div>
                    <div class="h-12"></div>
                </div>
            `;
        }

        function initApp() {
            window.toggleCheck = toggleCheck;
            window.addEventListener('click', function(e) {
                if (e.target === document.getElementById('location-modal')) closeModal();
            });

            // åˆå§‹åŒ–æ¨™é¡Œ
            document.getElementById('header-title').textContent = `âœˆï¸ ${appItineraryData.meta.title}`;
            document.getElementById('header-subtitle').textContent = appItineraryData.meta.subtitle;

            renderMainTabs();
            renderDayTabs();
            switchMainView('home');
        }

        document.addEventListener('DOMContentLoaded', () => {
            initApp();
        });
    </script>
</body>
</html>